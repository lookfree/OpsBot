# ZWD-OpsBot 功能需求文档

## 产品概述

### 产品定位
ZWD-OpsBot 是一款面向开发、测试、运维人员的**运维终端工具**，集成了SSH终端、数据库管理、中间件管理、Docker管理等核心运维功能。同时提供可选的AI智能体能力，在大模型可用时提供智能化辅助。

### 核心理念
**离线优先，智能增强**
- 所有基础运维功能**完全离线可用**，不依赖任何大模型或网络服务
- AI智能功能作为**可选增强**，在大模型可用时提供额外便利
- 即使没有配置大模型，也是一个功能完整的运维终端

### 目标用户
- 开发工程师
- 测试工程师
- 运维工程师
- DevOps工程师

### 核心价值
有了这个运维工具，用户不需要安装 XShell等SSH终端、各种数据库终端（Navicat、DBeaver）、各种中间件终端（Redis、Kafka、Elasticsearch），还有Docker的终端。ZWD-OpsBot集成了这些终端的基本功能，方便目标用户部署、运维、管理这些资源上的服务。

**工具优势**：
- 一站式运维：SSH、数据库、中间件、Docker统一管理
- 跨平台支持：Windows、macOS、Linux
- 离线可用：核心功能不依赖网络
- 智能增强（可选）：配置大模型后可获得AI辅助能力

---

## 基础功能模块

### 通用模块

| 功能                       |
| -------------------------- |
| 标签数量                   |
| 多窗口                     |
| 分屏显示(同屏显示多个视图) |
| 配置导入导出               |
| 亮色/暗色双主题            |

### 数据库模块

| 功能            |
| --------------- |
| SQL查询编辑器   |
| 数据内联编辑    |
| 表结构编辑      |
| 视图            |
| SSH代理连接     |
| SQL查询结果编辑 |
| 表结构同步      |
| 表数据同步      |
| 表数据传输      |
| 实时面板        |
| 数据字典导出    |
| 性能监控        |
| 慢日志分析      |

**支持的数据库：** MySQL、MariaDB、PostgreSQL、SQLite

### SSH模块

| 功能                       |
| -------------------------- |
| SSH终端                    |
| RDP                        |
| 跳板机                     |
| 命令输入广播               |
| SOCKS5、HTTP/HTTPS代理     |
| 密码、秘钥、交互式验证登录 |
| X11转发                    |
| SSH-COPY-ID                |
| ZMODEM协议(LRZSZ)          |
| SCP协议                    |
| TRZSZ                      |
| SFTP路径联动               |
| 历史命令                   |
| 批量执行命令               |

### SFTP模块

| 功能               |
| ------------------ |
| 本地文件目录视图   |
| 远程文件目录视图   |
| 文件拖拽上传/下载  |
| 服务器互相传输文件 |
| 多服务器文件上传   |
| 文件直接编辑       |
| SUDO提权           |
| 修改文件/目录权限  |
| 文件后台传输       |

### Docker模块

| 功能                   |
| ---------------------- |
| 容器管理               |
| 镜像管理               |
| Docker-Compose容器编辑 |
| 自定义Docker镜像仓库   |
| 镜像导入/导出          |
| SSH代理连接            |
| 实时面板               |
| 容器终端               |
| 容器日志               |
| 容器指标趋势           |

---

## 中间件模块

支持 Kafka、Elasticsearch、Redis、ClickHouse

### 1. 连接管理

- 添加/编辑/删除中间件连接
- 连接测试和状态监控
- 连接配置管理

### 2. Redis管理

- 集群信息查看
- Key管理和操作
- 配置查看和修改
- 命令行终端
- 数据分析

### 3. Elasticsearch管理

- 集群状态监控
- 索引管理
- 查询分析器
- 文档管理

### 4. Kafka管理

- 集群信息
- Topic管理
- 消费者组监控
- 消息查看

### 5. ClickHouse管理

- 集群状态
- 表结构管理
- 查询执行器
- 性能分析

---

## AI智能体模块（可选）

> **说明**：本模块为可选功能，需要配置大模型后才能使用。未配置大模型时，所有基础运维功能正常可用。

### 模块设计原则

1. **离线优先**：基础功能不依赖AI，确保工具可独立使用
2. **渐进增强**：AI功能作为辅助，提升效率但不阻断工作流
3. **优雅降级**：大模型不可用时，自动降级为手动操作

### 大模型集成方案

支持多种大模型后端，用户可根据实际需求灵活选择：

| 模式 | 提供商 | 适用场景 | 特点 |
|------|--------|---------|------|
| 云端API | OpenAI GPT-4、Claude、通义千问、文心一言 | 复杂推理、高质量生成 | 能力强、需联网、有成本 |
| 本地模型 | Ollama (Llama3、Qwen2、DeepSeek等) | 数据敏感、离线环境、成本敏感 | 数据安全、免费、需要GPU |
| 自定义API | 兼容OpenAI格式的任意端点 | 企业私有部署 | 可控性强 |
| 未配置 | - | 纯手动运维 | 完全离线可用 |

### AI功能可用性指示

界面上显示AI状态指示器：
- 🟢 AI可用：大模型已连接，智能功能可用
- 🟡 AI降级：大模型响应慢，部分功能可用
- ⚫ AI离线：未配置或不可用，使用手动模式

---

## 智能部署运维模块

> 本模块功能在AI可用时提供智能辅助，AI不可用时仍可手动操作完成相同任务。

### 1. 部署流程编排

#### 功能概述

| 项目 | 内容 |
|------|------|
| **功能描述** | 根据部署需求，生成部署流程脚本，支持Docker Compose、Shell脚本、Ansible Playbook等格式 |
| **使用场景** | 新项目部署、环境迁移、多节点批量部署、服务扩容 |

#### AI可用 vs AI离线对比

| 操作 | AI可用 | AI离线 |
|------|--------|--------|
| 创建部署配置 | 自然语言描述需求，AI自动生成 | 手动编写或从模板选择 |
| 依赖分析 | AI自动分析服务依赖顺序 | 用户手动指定部署顺序 |
| 配置优化 | AI提供最佳实践建议 | 参考内置文档模板 |

#### AI辅助示例
```
用户: 帮我部署一套 Spring Boot + MySQL + Redis 的微服务环境

AI: 好的，我来为你规划部署方案。

📋 服务分析：
- Spring Boot 应用 (端口: 8080)
- MySQL 数据库 (端口: 3306)
- Redis 缓存 (端口: 6379)

📊 部署顺序（基于依赖关系）：
1. MySQL (无依赖)
2. Redis (无依赖)
3. Spring Boot (依赖 MySQL、Redis)

🔧 生成的 docker-compose.yml：
[自动生成配置文件...]

[保存配置] [执行部署] [修改配置]
```

#### 手动模式
- 从内置模板库选择配置模板
- 手动编辑配置文件
- 使用可视化编辑器调整参数

---

### 2. 中间件自动部署

> **核心功能**：本功能完全离线可用，不依赖AI。用户只需提供主机信息和选择中间件，系统自动完成全部部署流程。

#### 功能概述

| 项目 | 内容 |
|------|------|
| **功能描述** | 用户指定目标主机（提供登录信息）和中间件类型，系统自动完成安装包下载、文件传输、安装配置、服务启动的全流程部署 |
| **使用场景** | 快速搭建中间件集群（Kafka、Redis、ES等）、环境初始化、批量部署 |
| **是否依赖AI** | **否** - 完全自动化，无需AI辅助即可完成全部操作 |

#### 部署方式

支持两种部署方式，用户可根据实际需求选择：

| 部署方式 | 说明 | 适用场景 |
|---------|------|---------|
| **非容器化部署** | 直接在目标服务器安装，下载官方安装包解压配置 | 生产环境、对性能要求高、需要精细控制 |
| **容器化部署** | 使用Docker/Docker Compose部署 | 快速部署、测试环境、资源隔离、便于迁移 |

#### 支持的中间件

| 中间件 | 支持版本 | 单机模式 | 集群模式 | 非容器化 | 容器化 |
|--------|---------|:--------:|---------|:--------:|:------:|
| **Kafka** | 3.x、4.x | ✓ | KRaft集群、ZooKeeper集群 | ✓ | ✓ |
| **Redis** | 6.x、7.x | ✓ | 主从复制、哨兵模式、Cluster集群 | ✓ | ✓ |
| **Elasticsearch** | 7.x、8.x | ✓ | 多节点集群 | ✓ | ✓ |
| **MySQL** | 5.7、8.x | ✓ | 主从复制、MGR集群 | ✓ | ✓ |
| **PostgreSQL** | 14、15、16 | ✓ | 主从流复制 | ✓ | ✓ |
| **ClickHouse** | 23.x、24.x | ✓ | 分片集群（Shard+Replica） | ✓ | ✓ |
| **ZooKeeper** | 3.x | ✓ | 集群（3/5/7节点） | ✓ | ✓ |
| **RabbitMQ** | 3.x | ✓ | 镜像队列集群 | ✓ | ✓ |
| **MongoDB** | 6.x、7.x | ✓ | 副本集、分片集群 | ✓ | ✓ |
| **Nginx** | 1.24、1.25 | ✓ | - | ✓ | ✓ |
| **MinIO** | RELEASE.2024-x | ✓ | 分布式集群 | ✓ | ✓ |
| **Nacos** | 2.x | ✓ | 集群模式 | ✓ | ✓ |
| **Consul** | 1.x | ✓ | 集群模式 | ✓ | ✓ |
| **etcd** | 3.x | ✓ | 集群模式 | ✓ | ✓ |

#### 集群模式详细说明

**Kafka 集群模式：**
| 模式 | 节点数 | 说明 |
|------|--------|------|
| 单机 | 1 | 开发测试使用 |
| KRaft集群 | 3+ | Kafka 3.3+推荐，无需ZooKeeper |
| ZooKeeper集群 | 3+ Kafka + 3+ ZK | 传统模式，需要额外部署ZooKeeper |

**Redis 集群模式：**
| 模式 | 节点数 | 说明 |
|------|--------|------|
| 单机 | 1 | 开发测试使用 |
| 主从复制 | 1主+N从 | 读写分离，手动故障切换 |
| 哨兵模式 | 1主+N从+3哨兵 | 自动故障转移 |
| Cluster集群 | 6+ (3主3从) | 数据分片，高可用 |

**MySQL 集群模式：**
| 模式 | 节点数 | 说明 |
|------|--------|------|
| 单机 | 1 | 开发测试使用 |
| 主从复制 | 1主+N从 | 读写分离 |
| MGR集群 | 3+ | MySQL Group Replication，多主模式 |

**Elasticsearch 集群模式：**
| 模式 | 节点数 | 说明 |
|------|--------|------|
| 单机 | 1 | 开发测试使用 |
| 多节点集群 | 3+ | 包含Master、Data、Coordinating角色 |

**MongoDB 集群模式：**
| 模式 | 节点数 | 说明 |
|------|--------|------|
| 单机 | 1 | 开发测试使用 |
| 副本集 | 3+ | 高可用，自动故障转移 |
| 分片集群 | 多分片+Config+Mongos | 水平扩展，大数据量 |

#### 部署流程

```
┌─────────────────────────────────────────────────────────────────┐
│                      中间件自动部署流程                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  1. 配置部署信息                                                 │
│     ┌──────────────────────────────────────────────────────┐   │
│     │ 目标主机:                                             │   │
│     │   主机1: 192.168.1.101 (root/***) [broker-1]        │   │
│     │   主机2: 192.168.1.102 (root/***) [broker-2]        │   │
│     │   主机3: 192.168.1.103 (root/***) [broker-3]        │   │
│     │                                                      │   │
│     │ 中间件: [Kafka ▼]  版本: [4.0 ▼]                     │   │
│     │ 部署模式: [KRaft集群 ▼]                              │   │
│     │ 安装目录: /opt/kafka                                 │   │
│     │ 数据目录: /data/kafka                                │   │
│     └──────────────────────────────────────────────────────┘   │
│                              ↓                                  │
│  2. 环境预检查                                                   │
│     ├─ 检查主机连通性 ✓                                         │
│     ├─ 检查磁盘空间 ✓                                           │
│     ├─ 检查端口占用 ✓                                           │
│     ├─ 检查Java环境 ✓                                           │
│     └─ 检查防火墙规则 ✓                                         │
│                              ↓                                  │
│  3. 下载安装包                                                   │
│     ├─ 从官方镜像源下载 kafka_2.13-4.0.0.tgz                    │
│     ├─ 校验MD5/SHA256 ✓                                         │
│     └─ 缓存到本地仓库（下次部署可复用）                          │
│                              ↓                                  │
│  4. 分发安装包                                                   │
│     ├─ 并行传输到 192.168.1.101 ✓                               │
│     ├─ 并行传输到 192.168.1.102 ✓                               │
│     └─ 并行传输到 192.168.1.103 ✓                               │
│                              ↓                                  │
│  5. 执行安装                                                     │
│     ├─ 解压安装包                                               │
│     ├─ 生成配置文件（根据集群角色定制）                          │
│     ├─ 设置环境变量                                             │
│     ├─ 配置系统服务                                             │
│     └─ 启动服务                                                 │
│                              ↓                                  │
│  6. 验证部署                                                     │
│     ├─ 检查服务状态                                             │
│     ├─ 检查集群状态                                             │
│     ├─ 执行健康检查                                             │
│     └─ 生成部署报告                                             │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 配置界面示例

**非容器化部署配置：**
```
┌─────────────────────────────────────────────────────────────────┐
│ 中间件自动部署                                    [开始部署]     │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ ▼ 基本配置                                                      │
│   中间件类型: [Kafka        ▼]                                  │
│   版本:      [4.0.0        ▼]                                  │
│   部署方式:  [◉ 非容器化  ○ 容器化(Docker)]                     │
│   集群模式:  [KRaft集群(3节点) ▼]                               │
│                                                                 │
│ ▼ 目标主机 (3台)                                    [+ 添加主机] │
│   ┌────────────────────────────────────────────────────────┐   │
│   │ #  │ IP地址         │ 用户名 │ 认证方式 │ 角色          │   │
│   ├────┼────────────────┼────────┼──────────┼───────────────┤   │
│   │ 1  │ 192.168.1.101 │ root   │ 密码     │ controller    │   │
│   │ 2  │ 192.168.1.102 │ root   │ 密码     │ controller    │   │
│   │ 3  │ 192.168.1.103 │ root   │ 密码     │ controller    │   │
│   └────────────────────────────────────────────────────────┘   │
│   [从连接管理导入] [批量添加] [测试连接]                         │
│                                                                 │
│ ▼ 安装配置                                                      │
│   安装目录: [/opt/kafka                    ]                    │
│   数据目录: [/data/kafka                   ]                    │
│   日志目录: [/var/log/kafka                ]                    │
│                                                                 │
│ ▼ 集群配置                                                      │
│   集群ID:   [auto-generate                 ]                    │
│   监听端口: [9092                          ]                    │
│   控制器端口: [9093                        ]                    │
│                                                                 │
│ ▼ 高级选项                                                      │
│   [✓] 配置系统服务(systemd)                                     │
│   [✓] 开机自启动                                                │
│   [✓] 配置防火墙规则                                            │
│   [✓] 部署完成后验证                                            │
│                                                                 │
│ ▼ 安装包来源                                                    │
│   [◉] ZWD-OpsBot资源站 (推荐，由官方团队维护)                   │
│   [○] 中间件官方源 (https://downloads.apache.org等)            │
│   [○] 国内镜像 (清华/阿里云)                                    │
│   [○] 指定目录: [/data/packages/          ] [浏览...]          │
│   [○] 自定义URL: [________________________]                     │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**容器化部署配置：**
```
┌─────────────────────────────────────────────────────────────────┐
│ 中间件自动部署                                    [开始部署]     │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ ▼ 基本配置                                                      │
│   中间件类型: [Kafka        ▼]                                  │
│   版本:      [4.0.0        ▼]                                  │
│   部署方式:  [○ 非容器化  ◉ 容器化(Docker)]                     │
│   集群模式:  [KRaft集群(3节点) ▼]                               │
│                                                                 │
│ ▼ 目标主机 (3台)                                    [+ 添加主机] │
│   ┌────────────────────────────────────────────────────────┐   │
│   │ #  │ IP地址         │ 用户名 │ Docker状态 │ 角色        │   │
│   ├────┼────────────────┼────────┼────────────┼─────────────┤   │
│   │ 1  │ 192.168.1.101 │ root   │ ✅ 已安装   │ controller  │   │
│   │ 2  │ 192.168.1.102 │ root   │ ✅ 已安装   │ controller  │   │
│   │ 3  │ 192.168.1.103 │ root   │ ❌ 未安装   │ controller  │   │
│   └────────────────────────────────────────────────────────┘   │
│   ⚠️ 192.168.1.103 未安装Docker，将自动安装                      │
│                                                                 │
│ ▼ 容器配置                                                      │
│   镜像源:     [◉ ZWD-OpsBot镜像站  ○ Docker Hub  ○ 阿里云]      │
│   容器名前缀: [kafka-                      ]                    │
│   网络模式:   [bridge        ▼]                                 │
│   数据卷路径: [/data/kafka                 ]                    │
│                                                                 │
│ ▼ 集群配置                                                      │
│   集群ID:   [auto-generate                 ]                    │
│   监听端口: [9092                          ]                    │
│   控制器端口: [9093                        ]                    │
│                                                                 │
│ ▼ 资源限制                                                      │
│   CPU限制:  [2        ] 核                                      │
│   内存限制: [4        ] GB                                      │
│   [✓] 开机自启动 (--restart=always)                             │
│                                                                 │
│ ▼ 高级选项                                                      │
│   [✓] 生成docker-compose.yml                                    │
│   [✓] 配置防火墙规则                                            │
│   [✓] 部署完成后验证                                            │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 两种部署方式对比

| 对比项 | 非容器化部署 | 容器化部署 |
|--------|-------------|-----------|
| **部署速度** | 较慢（需下载完整安装包） | 较快（拉取镜像） |
| **性能** | 原生性能，无额外开销 | 略有开销，但通常可忽略 |
| **资源隔离** | 共享系统资源 | 容器级别隔离 |
| **迁移性** | 需要重新部署 | 镜像可直接迁移 |
| **管理方式** | systemd服务管理 | docker/docker-compose管理 |
| **适用环境** | 生产环境、高性能要求 | 测试环境、快速验证、CI/CD |
| **依赖要求** | 系统依赖（如JDK） | 仅需Docker |
| **配置复杂度** | 较复杂 | 相对简单 |

#### 部署执行界面

```
┌─────────────────────────────────────────────────────────────────┐
│ 部署进度 - Kafka 4.0.0 KRaft集群                   [取消] [暂停] │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ 整体进度: ████████████████░░░░░░░░░░░░░░░░ 55%                  │
│                                                                 │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 阶段                          │ 状态     │ 耗时    │ 详情   │ │
│ ├───────────────────────────────┼──────────┼─────────┼────────┤ │
│ │ 1. 环境预检查                 │ ✅ 完成   │ 5s      │ [查看] │ │
│ │ 2. 下载安装包                 │ ✅ 完成   │ 45s     │ [查看] │ │
│ │ 3. 分发安装包                 │ ✅ 完成   │ 30s     │ [查看] │ │
│ │ 4. 执行安装                   │ 🔄 进行中 │ 20s     │ [查看] │ │
│ │ 5. 验证部署                   │ ⏳ 等待   │ -       │        │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│ 当前任务: 执行安装 - 配置集群                                    │
│                                                                 │
│ 主机状态:                                                        │
│   192.168.1.101 [controller] ████████████░░░░░░░░ 60% 生成配置  │
│   192.168.1.102 [controller] ████████████░░░░░░░░ 60% 生成配置  │
│   192.168.1.103 [controller] ████████████░░░░░░░░ 60% 生成配置  │
│                                                                 │
│ 实时日志:                                                        │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ [14:32:15] 192.168.1.101: 解压 kafka_2.13-4.0.0.tgz 完成    │ │
│ │ [14:32:16] 192.168.1.102: 解压 kafka_2.13-4.0.0.tgz 完成    │ │
│ │ [14:32:16] 192.168.1.103: 解压 kafka_2.13-4.0.0.tgz 完成    │ │
│ │ [14:32:18] 生成集群ID: MkU3OEVBNTcwNTJENDM2Qk...            │ │
│ │ [14:32:20] 192.168.1.101: 写入 server.properties            │ │
│ │ [14:32:20] 192.168.1.102: 写入 server.properties            │ │
│ │ [14:32:20] 192.168.1.103: 写入 server.properties            │ │
│ └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

#### 部署完成报告

```
┌─────────────────────────────────────────────────────────────────┐
│ ✅ 部署完成 - Kafka 4.0.0 KRaft集群                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ 📊 部署概要                                                      │
│   中间件: Kafka 4.0.0                                           │
│   部署模式: KRaft集群 (3节点)                                   │
│   总耗时: 2分15秒                                               │
│   状态: 全部成功                                                 │
│                                                                 │
│ 🖥️ 节点信息                                                      │
│   ┌────────────────────────────────────────────────────────┐   │
│   │ 节点              │ 角色       │ 状态    │ 端口        │   │
│   ├───────────────────┼────────────┼─────────┼─────────────┤   │
│   │ 192.168.1.101    │ controller │ 🟢 运行 │ 9092, 9093 │   │
│   │ 192.168.1.102    │ controller │ 🟢 运行 │ 9092, 9093 │   │
│   │ 192.168.1.103    │ controller │ 🟢 运行 │ 9092, 9093 │   │
│   └────────────────────────────────────────────────────────┘   │
│                                                                 │
│ 🔗 连接信息                                                      │
│   Bootstrap Servers: 192.168.1.101:9092,192.168.1.102:9092,    │
│                      192.168.1.103:9092                        │
│                                                                 │
│ 📁 安装路径                                                      │
│   安装目录: /opt/kafka                                          │
│   数据目录: /data/kafka                                         │
│   日志目录: /var/log/kafka                                      │
│   配置文件: /opt/kafka/config/server.properties                │
│                                                                 │
│ 🔧 管理命令                                                      │
│   启动服务: systemctl start kafka                               │
│   停止服务: systemctl stop kafka                                │
│   查看状态: systemctl status kafka                              │
│   查看日志: journalctl -u kafka -f                              │
│                                                                 │
│ ✅ 健康检查                                                      │
│   ├─ 集群状态: 健康                                             │
│   ├─ Leader选举: 完成                                           │
│   ├─ 节点通信: 正常                                             │
│   └─ 测试Topic创建: 成功                                        │
│                                                                 │
│ [添加到连接管理] [导出报告] [查看详细日志] [关闭]                │
└─────────────────────────────────────────────────────────────────┘
```

#### 自动化程度说明

> **本功能为核心自动化功能，完全不依赖AI，所有操作均可自动完成。**

| 操作 | 自动化程度 | 说明 |
|------|:----------:|------|
| 选择中间件/版本 | ✅ 全自动 | 下拉选择，内置版本列表 |
| 配置目标主机 | ✅ 全自动 | 支持批量添加、从连接管理导入 |
| 环境预检查 | ✅ 全自动 | 自动检查端口、磁盘、依赖等 |
| 下载安装包 | ✅ 全自动 | 多源下载、断点续传、本地缓存 |
| 分发安装包 | ✅ 全自动 | 并行传输到所有目标主机 |
| 执行安装 | ✅ 全自动 | 解压、配置、启动一体化 |
| 生成集群配置 | ✅ 全自动 | 根据集群模式自动生成节点配置 |
| 配置系统服务 | ✅ 全自动 | 自动配置systemd/docker服务 |
| 健康检查 | ✅ 全自动 | 部署完成自动验证 |
| 失败回滚 | ✅ 全自动 | 一键回滚到部署前状态 |

#### AI增强（可选）

当AI可用时，可提供额外的智能辅助：

| 功能 | AI增强效果 |
|------|-----------|
| 配置优化 | 根据目标服务器硬件配置推荐最佳参数 |
| 问题诊断 | 部署失败时分析原因并给出修复建议 |
| 性能调优 | 根据使用场景推荐JVM参数、分区数等 |

**注意**：以上AI增强为可选功能，不影响部署的自动化执行。

#### 安装包管理

```
┌─────────────────────────────────────────────────────────────────┐
│ 本地安装包仓库                                      [刷新] [清理] │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ 📦 已缓存的安装包                                                │
│   ┌──────────────────────────────────────────────────────────┐ │
│   │ 中间件        │ 版本   │ 大小    │ 下载时间    │ 操作    │ │
│   ├───────────────┼────────┼─────────┼─────────────┼─────────┤ │
│   │ Kafka        │ 4.0.0  │ 108MB   │ 2024-01-15 │ [删除]  │ │
│   │ Kafka        │ 3.7.0  │ 105MB   │ 2024-01-10 │ [删除]  │ │
│   │ Redis        │ 7.2.4  │ 3.2MB   │ 2024-01-12 │ [删除]  │ │
│   │ Elasticsearch│ 8.12.0 │ 562MB   │ 2024-01-08 │ [删除]  │ │
│   └──────────────────────────────────────────────────────────┘ │
│                                                                 │
│ 总占用空间: 778MB                                                │
│                                                                 │
│ [预下载常用版本] [导入本地包] [设置缓存大小]                      │
└─────────────────────────────────────────────────────────────────┘
```

#### 安装包来源说明

| 来源 | 说明 | 适用场景 |
|------|------|---------|
| **ZWD-OpsBot资源站** | 官方团队维护的配套资源站，提供经过验证的安装包和Docker镜像 | 推荐，稳定可靠 |
| **中间件官方源** | Apache、Redis.io等官方下载站 | 需要最新版本 |
| **国内镜像** | 清华、阿里云等国内镜像站 | 国内网络环境 |
| **指定目录** | 从本地或网络共享目录获取安装包 | 离线环境、内网部署 |
| **自定义URL** | 用户指定的下载地址 | 企业内部资源站 |

#### ZWD-OpsBot配套资源站

> **说明**：ZWD-OpsBot配套资源站由官方团队维护，提供与工具版本匹配的中间件安装包和Docker镜像。

**资源站提供内容：**
- 各中间件的多版本安装包（已验证兼容性）
- 预配置的Docker镜像（优化过的官方镜像）
- 安装包校验信息（MD5/SHA256）
- 版本兼容性说明文档

**资源站优势：**
- 国内CDN加速，下载速度快
- 版本经过测试验证，稳定可靠
- 与ZWD-OpsBot版本匹配，兼容性好
- 统一的目录结构，便于自动化获取

**资源站配置：**
```
┌─────────────────────────────────────────────────────────────────┐
│ 资源站设置                                              [设置]   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ ZWD-OpsBot资源站地址:                                           │
│   [https://resources.zwd-opsbot.com    ] [测试连接]             │
│                                                                 │
│ 镜像仓库地址:                                                    │
│   [registry.zwd-opsbot.com             ] [测试连接]             │
│                                                                 │
│ 本地缓存目录:                                                    │
│   [~/.zwd-opsbot/packages              ] [浏览...]              │
│                                                                 │
│ 缓存策略:                                                        │
│   [✓] 启用本地缓存                                              │
│   [✓] 自动清理30天前的缓存                                      │
│   最大缓存空间: [10      ] GB                                   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 特性说明

| 特性 | 说明 |
|------|------|
| **多源下载** | 支持资源站、官方源、国内镜像、指定目录、自定义URL |
| **断点续传** | 大文件下载支持断点续传 |
| **安装包缓存** | 下载的安装包本地缓存，重复部署无需再次下载 |
| **并行传输** | 多主机并行传输安装包，提升效率 |
| **配置模板** | 内置各中间件的最佳实践配置模板 |
| **集群感知** | 自动生成集群配置（节点ID、选举配置等） |
| **服务托管** | 自动配置systemd服务，支持开机自启 |
| **健康检查** | 部署完成后自动执行健康检查 |
| **回滚支持** | 部署失败支持一键回滚 |

---

### 3. 环境配置检查

#### 功能概述

| 项目 | 内容 |
|------|------|
| **功能描述** | 部署前检查目标服务器环境，包括端口占用、磁盘空间、依赖版本、权限配置、网络连通性等 |
| **使用场景** | 部署前预检、故障排查、合规检查、环境一致性检查 |

#### 检查项目

| 检查类别 | 检查项 | 自动修复 |
|---------|--------|---------|
| 系统资源 | CPU核数、内存大小、磁盘空间 | 否 |
| 端口检查 | 目标端口是否被占用 | 是（可选） |
| 依赖版本 | Docker、Java、Node等版本 | 是（可选） |
| 权限检查 | 目录权限、用户组 | 是（可选） |
| 网络检查 | 防火墙规则、网络连通性 | 是（可选） |

#### AI可用 vs AI离线对比

| 操作 | AI可用 | AI离线 |
|------|--------|--------|
| 检查执行 | 自动执行所有检查 ✓ | 自动执行所有检查 ✓ |
| 结果分析 | AI分析问题原因并给出修复建议 | 显示检查结果，用户自行判断 |
| 修复操作 | AI生成修复脚本 | 用户手动修复或选择预设修复脚本 |

#### 检查报告示例
```
📋 环境检查报告

服务器: prod-server-01 (192.168.1.100)
检查时间: 2024-01-15 10:30:00

✅ 通过项 (8项)
- CPU: 4核 ✓ (要求≥2核)
- 内存: 8GB ✓ (要求≥4GB)
- Docker: 20.10.21 ✓
- 端口 3306: 空闲 ✓
- 端口 6379: 空闲 ✓

⚠️ 警告项 (2项)
- 磁盘空间: 15GB可用 (建议≥20GB)
- swap未配置 (建议配置4GB)

❌ 失败项 (1项)
- 端口 8080: 被进程 nginx (PID: 1234) 占用

[一键修复] [跳过检查] [重新检查]
```

---

### 3. 配置文件生成

#### 功能概述

| 项目 | 内容 |
|------|------|
| **功能描述** | 生成各类配置文件，支持Nginx、Docker Compose、K8s YAML、应用配置文件等 |
| **使用场景** | 快速生成标准配置、配置迁移、批量配置生成 |

#### 支持的配置类型
- **Web服务器**: Nginx、Apache、Caddy
- **容器编排**: Docker Compose、K8s Deployment/Service/ConfigMap
- **数据库**: MySQL my.cnf、PostgreSQL postgresql.conf、Redis redis.conf
- **中间件**: Kafka server.properties、ES elasticsearch.yml
- **应用配置**: Spring application.yml、.env环境变量

#### AI可用 vs AI离线对比

| 操作 | AI可用 | AI离线 |
|------|--------|--------|
| 创建配置 | 自然语言描述，AI生成 | 从模板库选择，手动编辑 |
| 参数调优 | AI根据场景推荐参数 | 参考文档手动调整 |
| 语法检查 | 自动检查 ✓ | 自动检查 ✓ |

#### 内置模板库（AI离线时使用）
- Nginx反向代理模板
- Nginx负载均衡模板
- Docker Compose单服务模板
- Docker Compose微服务模板
- MySQL主从配置模板
- Redis集群配置模板
- ...

---

### 4. 运维脚本生成

#### 功能概述

| 项目 | 内容 |
|------|------|
| **功能描述** | 生成各类运维脚本（Shell、Python），支持语法检查、安全审计 |
| **使用场景** | 日志清理、数据备份、监控告警、批量操作等 |

#### AI可用 vs AI离线对比

| 操作 | AI可用 | AI离线 |
|------|--------|--------|
| 创建脚本 | 自然语言描述，AI生成 | 从脚本模板库选择 |
| 脚本定制 | AI根据需求定制参数 | 手动修改模板参数 |
| 安全检查 | AI + 规则双重检查 | 规则检查 |
| 语法校验 | 自动校验 ✓ | 自动校验 ✓ |

#### 内置脚本模板库
```
📂 脚本模板库
├── 日志管理
│   ├── 日志清理脚本（按天数/大小）
│   ├── 日志轮转配置
│   └── 日志压缩归档
├── 数据备份
│   ├── MySQL备份脚本
│   ├── PostgreSQL备份脚本
│   ├── Redis RDB备份
│   └── 文件目录备份
├── 监控检查
│   ├── 磁盘空间检查
│   ├── 服务状态检查
│   ├── 端口连通性检查
│   └── 进程存活检查
├── 系统维护
│   ├── 系统清理脚本
│   ├── 安全加固脚本
│   └── 用户管理脚本
└── 应用部署
    ├── Java应用启停脚本
    ├── Node应用启停脚本
    └── Docker服务管理脚本
```

---

### 5. 定时任务管理

#### 功能概述

| 项目 | 内容 |
|------|------|
| **功能描述** | 配置和管理定时任务，支持cron表达式，任务执行监控 |
| **使用场景** | 定时备份、定时清理、定时检查、定时报告 |

#### AI可用 vs AI离线对比

| 操作 | AI可用 | AI离线 |
|------|--------|--------|
| 时间配置 | 自然语言（"每天凌晨3点"）→ cron | 直接输入cron表达式或使用可视化选择器 |
| 冲突检测 | AI智能分析任务冲突 | 基于规则的冲突检测 |
| 执行监控 | 全功能 ✓ | 全功能 ✓ |
| 失败告警 | 全功能 ✓ | 全功能 ✓ |

#### 可视化Cron编辑器（AI离线时）
```
┌─────────────────────────────────────┐
│ 定时任务配置                         │
├─────────────────────────────────────┤
│ 执行频率: [每天 ▼]                  │
│ 执行时间: [03] 时 [00] 分           │
│                                     │
│ Cron表达式: 0 3 * * *              │
│                                     │
│ 预览: 每天 03:00 执行               │
│ 下次执行: 2024-01-16 03:00:00      │
└─────────────────────────────────────┘
```

---

### 6. 批量操作

#### 功能概述

| 项目 | 内容 |
|------|------|
| **功能描述** | 批量执行命令或脚本，支持多种执行策略、结果汇总 |
| **使用场景** | 批量更新配置、批量重启服务、批量检查状态 |

#### 执行策略

| 策略 | 描述 | 适用场景 |
|------|------|---------|
| 并行执行 | 所有服务器同时执行 | 查询类操作 |
| 串行执行 | 逐台执行，等待完成 | 高风险操作 |
| 滚动执行 | 分批执行，每批N台 | 服务重启 |
| 金丝雀执行 | 先执行1台，确认后继续 | 生产环境变更 |

#### AI可用 vs AI离线对比

| 操作 | AI可用 | AI离线 |
|------|--------|--------|
| 命令执行 | 全功能 ✓ | 全功能 ✓ |
| 结果汇总 | 全功能 ✓ | 全功能 ✓ |
| 结果分析 | AI分析失败原因并给建议 | 显示原始错误信息 |
| 差异对比 | AI智能分析差异 | 文本对比显示 |

#### 执行结果示例
```
📊 批量执行结果

执行命令: systemctl restart nginx
目标服务器: 50台
执行策略: 滚动执行 (每批10台)

✅ 成功: 48台
❌ 失败: 2台

失败详情：
┌──────────────┬─────────────────────────────────┐
│ 服务器        │ 错误信息                         │
├──────────────┼─────────────────────────────────┤
│ web-server-23│ Job for nginx.service failed    │
│ web-server-41│ Connection refused              │
└──────────────┴─────────────────────────────────┘

[重试失败服务器] [查看详细日志] [导出报告]
```

---

### 7. 工作流编排

#### 功能概述

| 项目 | 内容 |
|------|------|
| **功能描述** | 可视化编排多步骤运维工作流，支持条件分支、并行执行、人工审批 |
| **使用场景** | 标准化发布流程、故障恢复流程、日常运维自动化 |

#### 流程节点类型

| 节点类型 | 描述 | 示例 |
|---------|------|------|
| 执行节点 | 执行Shell/Python脚本 | 编译代码、部署服务 |
| 条件节点 | 根据条件分支 | 检查测试结果 |
| 审批节点 | 等待人工审批 | 生产环境发布确认 |
| 并行节点 | 多任务并行执行 | 同时部署多个服务 |
| 等待节点 | 等待指定时间或事件 | 等待服务启动 |
| 通知节点 | 发送通知 | 钉钉/邮件通知 |

#### AI可用 vs AI离线对比

| 操作 | AI可用 | AI离线 |
|------|--------|--------|
| 创建工作流 | 自然语言描述，AI生成流程 | 拖拽式可视化编辑器 |
| 流程执行 | 全功能 ✓ | 全功能 ✓ |
| 执行监控 | 全功能 ✓ | 全功能 ✓ |
| 异常处理 | AI建议处理方案 | 执行预设的异常处理分支 |

#### 可视化流程编辑器
```
┌────────────────────────────────────────────────────┐
│ 工作流编辑器                            [保存] [运行] │
├────────────────────────────────────────────────────┤
│                                                    │
│  ┌─────────┐                                       │
│  │ 开始    │                                       │
│  └────┬────┘                                       │
│       ↓                                            │
│  ┌─────────┐     ┌─────────┐                      │
│  │ 拉取代码 │ ──→ │ 单元测试 │                      │
│  └─────────┘     └────┬────┘                      │
│                       ↓                            │
│              ┌────────┴────────┐                  │
│              │ 测试通过？       │                  │
│              └───┬────────┬───┘                  │
│             是   ↓        ↓ 否                    │
│          ┌───────┐  ┌──────────┐                 │
│          │ 构建   │  │ 通知失败  │                 │
│          └───┬───┘  └──────────┘                 │
│              ↓                                    │
│         ┌────────┐                               │
│         │ 部署   │                               │
│         └────────┘                               │
│                                                    │
│ [节点库]  [执行] [条件] [审批] [并行] [通知]        │
└────────────────────────────────────────────────────┘
```

---

## 功能优先级与实现路径

### 第一阶段（MVP）- 基础终端能力

优先实现核心运维终端功能，确保离线可用：

| 优先级 | 模块 | 说明 |
|--------|------|------|
| P0 | SSH终端 | 核心功能 |
| P0 | SFTP文件管理 | 核心功能 |
| P0 | 数据库管理 | 核心功能 |
| P0 | Docker管理 | 核心功能 |
| P0 | 中间件管理 | 核心功能 |

### 第二阶段 - 部署运维能力

实现部署运维模块的基础功能（离线可用）：

| 优先级 | 功能 | 说明 |
|--------|------|------|
| P1 | 环境配置检查 | 自动检查 + 手动修复 |
| P1 | 批量操作 | 多策略执行 |
| P1 | 脚本模板库 | 内置常用脚本 |
| P1 | 配置模板库 | 内置常用配置 |
| P1 | 定时任务管理 | 可视化cron管理 |
| P1 | 工作流编排 | 可视化流程编辑器 |

### 第三阶段 - AI智能增强

在基础功能完善后，增加AI辅助能力：

| 优先级 | 功能 | 说明 |
|--------|------|------|
| P2 | 大模型集成框架 | 支持多种模型后端 |
| P2 | 自然语言配置生成 | AI生成配置文件 |
| P2 | 自然语言脚本生成 | AI生成运维脚本 |
| P2 | 智能结果分析 | AI分析执行结果 |
| P2 | 自然语言Cron | 自然语言转cron表达式 |

---

## 技术架构要求

### 整体架构

```
+------------------------------------------------------------------+
|                      前端 (React + Tauri)                         |
|  +------------------+  +------------------+  +------------------+ |
|  |  终端管理面板    |  |  部署运维面板     |  |  AI助手(可选)    | |
+------------------------------------------------------------------+
|                      Rust Backend (Tauri)                         |
|  +------------------+  +------------------+  +------------------+ |
|  |  连接管理       |  |  任务执行引擎     |  |  AI Engine      | |
|  |  (SSH/DB/...)   |  |  (脚本/工作流)    |  |  (可选模块)     | |
+------------------------------------------------------------------+
|                      外部依赖                                      |
|  +------------------+  +------------------+  +------------------+ |
|  |  目标服务器     |  |  数据库/中间件    |  |  大模型(可选)    | |
|  |  (SSH连接)      |  |  (驱动连接)       |  |  (API/本地)     | |
+------------------------------------------------------------------+
```

### 平台支持
- Windows (x64)
- macOS (Intel & Apple Silicon)
- Linux (x64)

### 技术栈
- **前端**: Tauri + React + TypeScript
- **后端**: Rust
- **大模型（可选）**: OpenAI API / Claude API / Ollama (本地)
- **多言支持**: i18n

### 插件机制

中间件的客户端及驱动使用插件的方式提供，第一次连接的时候自动到指定的网站下载驱动，自动下载失败的情况要告诉用户手动下载，放到指定的目录，这个可以参考 DBeaver 的实现。

### AI模块设计原则

1. **模块解耦**
   - AI模块作为独立可选组件
   - 核心功能不依赖AI模块

2. **优雅降级**
   - AI不可用时自动切换到手动模式
   - 提供完整的非AI替代方案（模板库、可视化编辑器等）

3. **状态透明**
   - 清晰显示AI可用状态
   - 明确提示哪些功能需要AI支持
