# ZWD-OpsBot 第一阶段开发计划

> 版本：v1.0
> 创建日期：2025-12-13
> 阶段目标：MVP - 基础终端能力

---

## 1. 阶段概述

### 1.1 目标

完成运维终端工具的核心功能，确保：
- 所有基础功能**离线可用**
- 替代常用运维工具（XShell、Navicat、DBeaver、Redis Desktop Manager等）
- 提供统一的运维体验

### 1.2 范围

| 模块 | 优先级 | 状态 |
|------|--------|------|
| 基础框架与UI骨架 | P0 | 待开发 |
| SSH终端 | P0 | 待开发 |
| SFTP文件管理 | P0 | 待开发 |
| 数据库管理（MySQL/PostgreSQL） | P0 | 待开发 |
| Docker管理 | P0 | 待开发 |
| 中间件管理（Redis/Kafka/ES） | P0 | 待开发 |
| 通用功能（多窗口/分屏/主题） | P0 | 待开发 |

### 1.3 交付物

- 可安装的桌面应用（Windows/macOS/Linux）
- 用户使用手册
- 开发文档

---

## 2. 技术架构

### 2.1 技术栈

```
┌────────────────────────────────────────────────────────────────┐
│                        ZWD-OpsBot                              │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │                    前端 (Frontend)                        │ │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │ │
│  │  │  React   │  │TypeScript│  │  Zustand │  │  Xterm.js│ │ │
│  │  │   18.x   │  │   5.x    │  │  状态管理 │  │  终端渲染 │ │ │
│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘ │ │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │ │
│  │  │TailwindCSS│ │ Radix UI │  │ Monaco   │  │ AG Grid  │ │ │
│  │  │  样式框架  │  │ 组件库   │  │ 编辑器   │  │ 数据表格 │ │ │
│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘ │ │
│  └──────────────────────────────────────────────────────────┘ │
│                              │                                 │
│                        Tauri IPC                               │
│                              │                                 │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │                    后端 (Backend - Rust)                  │ │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │ │
│  │  │  Tauri   │  │ russh    │  │ sqlx     │  │ bollard  │ │ │
│  │  │  框架    │  │ SSH客户端 │  │ 数据库   │  │ Docker   │ │ │
│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘ │ │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │ │
│  │  │ tokio    │  │ serde    │  │ redis-rs │  │ kafka-rs │ │ │
│  │  │ 异步运行时│  │ 序列化   │  │ Redis    │  │ Kafka    │ │ │
│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘ │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

### 2.2 项目结构

```
zwd-opsbot/
├── backend/                      # Rust后端
│   ├── src/
│   │   ├── main.rs              # 入口
│   │   ├── lib.rs               # 库定义
│   │   ├── commands/            # Tauri命令
│   │   │   ├── mod.rs
│   │   │   ├── ssh.rs           # SSH相关命令
│   │   │   ├── sftp.rs          # SFTP相关命令
│   │   │   ├── database.rs      # 数据库相关命令
│   │   │   ├── docker.rs        # Docker相关命令
│   │   │   └── middleware.rs    # 中间件相关命令
│   │   ├── services/            # 业务逻辑层
│   │   │   ├── mod.rs
│   │   │   ├── ssh_service.rs
│   │   │   ├── sftp_service.rs
│   │   │   ├── db_service.rs
│   │   │   ├── docker_service.rs
│   │   │   └── middleware_service.rs
│   │   ├── models/              # 数据模型
│   │   │   ├── mod.rs
│   │   │   ├── connection.rs    # 连接配置
│   │   │   └── result.rs        # 结果类型
│   │   ├── drivers/             # 驱动/插件管理
│   │   │   ├── mod.rs
│   │   │   └── driver_manager.rs
│   │   └── utils/               # 工具函数
│   │       ├── mod.rs
│   │       ├── crypto.rs        # 加密工具
│   │       └── config.rs        # 配置管理
│   ├── Cargo.toml
│   └── tauri.conf.json
│
├── front/                        # React前端
│   ├── main.tsx                 # 入口
│   ├── App.tsx                  # 根组件
│   ├── components/              # 组件
│   │   ├── layout/              # 布局组件
│   │   │   ├── Sidebar.tsx      # 侧边栏
│   │   │   ├── Header.tsx       # 顶部栏
│   │   │   ├── TabBar.tsx       # 标签页栏
│   │   │   └── SplitPane.tsx    # 分屏组件
│   │   ├── terminal/            # 终端组件
│   │   │   ├── Terminal.tsx
│   │   │   └── TerminalTabs.tsx
│   │   ├── database/            # 数据库组件
│   │   │   ├── QueryEditor.tsx
│   │   │   ├── ResultTable.tsx
│   │   │   └── TableTree.tsx
│   │   ├── sftp/                # SFTP组件
│   │   │   ├── FileExplorer.tsx
│   │   │   └── TransferPanel.tsx
│   │   ├── docker/              # Docker组件
│   │   │   ├── ContainerList.tsx
│   │   │   └── ImageList.tsx
│   │   ├── middleware/          # 中间件组件
│   │   │   ├── redis/
│   │   │   ├── kafka/
│   │   │   └── elasticsearch/
│   │   └── common/              # 通用组件
│   │       ├── ConnectionTree.tsx
│   │       ├── Modal.tsx
│   │       └── Toast.tsx
│   ├── hooks/                   # 自定义Hooks
│   ├── stores/                  # Zustand状态
│   │   ├── connectionStore.ts
│   │   ├── terminalStore.ts
│   │   └── themeStore.ts
│   ├── services/                # API调用层
│   │   └── tauri.ts            # Tauri IPC封装
│   ├── types/                   # TypeScript类型
│   └── styles/                  # 样式文件
│
├── public/                      # 静态资源
├── spec/                        # 规格文档
├── package.json
├── tailwind.config.js
├── tsconfig.json
└── vite.config.ts
```

### 2.3 数据存储

```
~/.zwd-opsbot/
├── config.json              # 应用配置
├── connections.encrypted    # 加密的连接配置
├── themes/                  # 自定义主题
├── drivers/                 # 下载的驱动
│   ├── mysql/
│   ├── postgresql/
│   ├── redis/
│   └── ...
├── cache/                   # 缓存目录
│   ├── packages/           # 安装包缓存
│   └── images/             # Docker镜像缓存
└── logs/                    # 日志文件
```

### 2.4 数据模型

#### 2.4.1 连接与目录数据结构

```typescript
// 模块类型
enum ModuleType {
  SSH = "ssh",
  Database = "database",
  Docker = "docker",
  Middleware = "middleware"
}

// 目录节点
interface Folder {
  id: string;                    // 唯一ID (UUID)
  name: string;                  // 目录名称
  moduleType: ModuleType;        // 所属模块类型
  parentId: string | null;       // 父目录ID (null表示在模块根目录下)
  order: number;                 // 排序序号
  expanded: boolean;             // 是否展开
  createdAt: string;             // 创建时间
  updatedAt: string;             // 更新时间
}

// 连接基础信息
interface ConnectionBase {
  id: string;                    // 唯一ID (UUID)
  name: string;                  // 连接名称
  moduleType: ModuleType;        // 模块类型
  folderId: string | null;       // 所属目录ID (null表示在模块根目录下)
  order: number;                 // 排序序号
  tags: string[];                // 标签（可选）
  createdAt: string;             // 创建时间
  updatedAt: string;             // 更新时间
  lastConnectedAt: string | null;// 最后连接时间
}

// SSH连接配置
interface SSHConnection extends ConnectionBase {
  moduleType: ModuleType.SSH;
  host: string;
  port: number;
  username: string;
  authType: "password" | "key" | "interactive";
  password?: string;             // 加密存储
  privateKey?: string;           // 加密存储
  passphrase?: string;           // 加密存储
  jumpHost?: {                   // 跳板机配置
    host: string;
    port: number;
    username: string;
    authType: "password" | "key";
    password?: string;
    privateKey?: string;
  };
  proxy?: {                      // 代理配置
    type: "socks5" | "http";
    host: string;
    port: number;
    username?: string;
    password?: string;
  };
  terminalSettings?: {           // 终端设置
    fontSize: number;
    fontFamily: string;
    colorScheme: string;
  };
}

// 数据库连接配置
interface DatabaseConnection extends ConnectionBase {
  moduleType: ModuleType.Database;
  dbType: "mysql" | "postgresql" | "sqlite";
  host: string;
  port: number;
  username: string;
  password?: string;             // 加密存储
  database?: string;
  sshTunnel?: {                  // SSH隧道
    enabled: boolean;
    sshConnectionId?: string;    // 引用已有SSH连接
    // 或者内联配置
    host?: string;
    port?: number;
    username?: string;
    authType?: "password" | "key";
    password?: string;
    privateKey?: string;
  };
}

// Docker连接配置
interface DockerConnection extends ConnectionBase {
  moduleType: ModuleType.Docker;
  connectionType: "local" | "ssh" | "tcp";
  // SSH方式
  sshConnectionId?: string;      // 引用已有SSH连接
  // TCP方式
  host?: string;
  port?: number;
  tlsEnabled?: boolean;
  tlsCert?: string;
  tlsKey?: string;
  tlsCa?: string;
}

// 中间件连接配置
interface MiddlewareConnection extends ConnectionBase {
  moduleType: ModuleType.Middleware;
  middlewareType: "redis" | "kafka" | "elasticsearch" | "clickhouse";
  // Redis
  redisConfig?: {
    mode: "standalone" | "sentinel" | "cluster";
    nodes: { host: string; port: number }[];
    password?: string;
    database?: number;
  };
  // Kafka
  kafkaConfig?: {
    bootstrapServers: string[];
    securityProtocol?: "PLAINTEXT" | "SASL_PLAINTEXT" | "SASL_SSL";
    saslMechanism?: string;
    username?: string;
    password?: string;
  };
  // Elasticsearch
  esConfig?: {
    nodes: string[];
    username?: string;
    password?: string;
    apiKey?: string;
  };
  // SSH代理（可选）
  sshTunnel?: {
    enabled: boolean;
    sshConnectionId?: string;
  };
}

// 连接树状态
interface ConnectionTreeState {
  folders: Folder[];
  connections: (SSHConnection | DatabaseConnection | DockerConnection | MiddlewareConnection)[];
}
```

#### 2.4.2 存储文件格式

**connections.encrypted 结构（解密后）：**
```json
{
  "version": "1.0",
  "folders": [
    {
      "id": "folder-uuid-1",
      "name": "生产环境",
      "moduleType": "ssh",
      "parentId": null,
      "order": 0,
      "expanded": true,
      "createdAt": "2025-12-13T10:00:00Z",
      "updatedAt": "2025-12-13T10:00:00Z"
    },
    {
      "id": "folder-uuid-2",
      "name": "华东区",
      "moduleType": "ssh",
      "parentId": "folder-uuid-1",
      "order": 0,
      "expanded": true,
      "createdAt": "2025-12-13T10:00:00Z",
      "updatedAt": "2025-12-13T10:00:00Z"
    }
  ],
  "connections": [
    {
      "id": "conn-uuid-1",
      "name": "prod-sh-01",
      "moduleType": "ssh",
      "folderId": "folder-uuid-2",
      "order": 0,
      "host": "192.168.1.101",
      "port": 22,
      "username": "root",
      "authType": "password",
      "password": "encrypted-password-here",
      "createdAt": "2025-12-13T10:00:00Z",
      "updatedAt": "2025-12-13T10:00:00Z",
      "lastConnectedAt": "2025-12-13T14:30:00Z"
    }
  ]
}
```

---

## 3. UI设计规范

### 3.1 设计原则

**参考 Claude Desktop 风格：**
- 简洁、现代的视觉设计
- 以暗色主题为主，支持亮色主题
- 大量留白，减少视觉噪音
- 平滑的过渡动画
- 清晰的层次结构

**参考 Navicat 结构：**
- 左侧连接树导航
- 中间主内容区（多标签页）
- 支持分屏显示
- 右侧可折叠详情面板

### 3.2 整体布局

```
┌─────────────────────────────────────────────────────────────────────────┐
│  ZWD-OpsBot                                    ─  □  ×  │ 窗口控制栏    │
├─────────────────────────────────────────────────────────────────────────┤
│ ┌───────┐ ┌──────────────────────────────────────────────────────────┐ │
│ │       │ │  ● SSH:prod-01  │  ● MySQL:db-01  │  + 新建标签          │ │
│ │ 连    │ ├──────────────────────────────────────────────────────────┤ │
│ │ 接    │ │                                                          │ │
│ │ 树    │ │                                                          │ │
│ │       │ │                      主 内 容 区                          │ │
│ │ ───── │ │                                                          │ │
│ │       │ │                  （终端/查询编辑器/                       │ │
│ │ 📁SSH  │ │                   文件管理器/容器列表等）                  │ │
│ │  └server│ │                                                          │ │
│ │ 📁数据库│ │                                                          │ │
│ │  └MySQL│ │                                                          │ │
│ │ 📁Docker│ │                                                          │ │
│ │ 📁中间件│ │                                                          │ │
│ │       │ │                                                          │ │
│ │       │ ├──────────────────────────────────────────────────────────┤ │
│ │       │ │ 底部面板（可折叠）：日志/传输任务/执行结果                  │ │
│ └───────┘ └──────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────────────────┤
│  就绪  │  连接数: 3  │  传输任务: 2  │                     状态栏      │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.3 色彩系统

**暗色主题 (默认)**

| 用途 | 颜色 | 色值 |
|------|------|------|
| 背景 - 主 | 深灰 | `#1a1a1a` |
| 背景 - 侧边栏 | 深灰2 | `#141414` |
| 背景 - 悬浮 | 灰色 | `#2a2a2a` |
| 背景 - 选中 | 蓝灰 | `#1e3a5f` |
| 文字 - 主 | 白色 | `#ffffff` |
| 文字 - 次 | 浅灰 | `#a0a0a0` |
| 文字 - 禁用 | 暗灰 | `#666666` |
| 强调色 - 主 | 蓝色 | `#3b82f6` |
| 强调色 - 悬浮 | 亮蓝 | `#60a5fa` |
| 成功 | 绿色 | `#22c55e` |
| 警告 | 黄色 | `#eab308` |
| 错误 | 红色 | `#ef4444` |
| 边框 | 暗灰 | `#333333` |

**亮色主题**

| 用途 | 颜色 | 色值 |
|------|------|------|
| 背景 - 主 | 白色 | `#ffffff` |
| 背景 - 侧边栏 | 浅灰 | `#f5f5f5` |
| 背景 - 悬浮 | 灰色 | `#eeeeee` |
| 背景 - 选中 | 浅蓝 | `#e0f2fe` |
| 文字 - 主 | 黑色 | `#1a1a1a` |
| 文字 - 次 | 灰色 | `#666666` |
| 强调色 - 主 | 蓝色 | `#2563eb` |
| 边框 | 浅灰 | `#e5e5e5` |

### 3.4 字体规范

```css
/* 系统字体栈 */
--font-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
             "Helvetica Neue", Arial, sans-serif;

/* 等宽字体（终端/代码） */
--font-mono: "JetBrains Mono", "Fira Code", "SF Mono", Menlo,
             Monaco, Consolas, monospace;

/* 字号规范 */
--text-xs: 12px;     /* 辅助文字 */
--text-sm: 13px;     /* 次要文字 */
--text-base: 14px;   /* 正文 */
--text-lg: 16px;     /* 标题 */
--text-xl: 18px;     /* 大标题 */
```

### 3.5 间距规范

```css
/* 间距单位：4px */
--spacing-1: 4px;
--spacing-2: 8px;
--spacing-3: 12px;
--spacing-4: 16px;
--spacing-5: 20px;
--spacing-6: 24px;
--spacing-8: 32px;

/* 圆角 */
--radius-sm: 4px;
--radius-md: 6px;
--radius-lg: 8px;
--radius-full: 9999px;
```

### 3.6 组件规范

#### 3.6.1 侧边栏连接树

**功能说明：**
- 每种类型模块（SSH、数据库、Docker、中间件）下支持创建**子目录**来分组管理连接
- 子目录支持**多层嵌套**，方便按项目、环境、区域等维度组织
- 支持**拖拽排序**和**拖拽移动**到不同目录
- 目录和连接均可**重命名**

```
┌─────────────────────────────┐
│  连接                  + ▼ │  ← 添加菜单（连接/目录）
├─────────────────────────────┤
│  🔍 搜索连接...             │  ← 搜索框（支持搜索目录和连接）
├─────────────────────────────┤
│                             │
│  ▼ 📁 SSH连接               │  ← 模块类型（固定）
│     ├─ 📂 生产环境          │  ← 用户创建的子目录
│     │   ├─ 📂 华东区        │  ← 支持多层嵌套
│     │   │   ├─ 🟢 prod-sh-01│
│     │   │   └─ 🟢 prod-sh-02│
│     │   └─ 📂 华北区        │
│     │       ├─ 🟢 prod-bj-01│
│     │       └─ ⚫ prod-bj-02│
│     ├─ 📂 测试环境          │
│     │   ├─ ⚫ test-01       │
│     │   └─ ⚫ test-02       │
│     └─ ⚫ dev-server        │  ← 也可直接放在模块根目录
│                             │
│  ▼ 📁 数据库                │
│     ├─ 📂 MySQL             │  ← 按数据库类型分组
│     │   ├─ 📂 生产          │
│     │   │   ├─ 🟢 mysql-master│
│     │   │   └─ 🟢 mysql-slave│
│     │   └─ 📂 测试          │
│     │       └─ ⚫ mysql-test│
│     └─ 📂 PostgreSQL        │
│         └─ ⚫ pg-prod       │
│                             │
│  ▼ 📁 Docker                │
│     ├─ 📂 K8s集群           │
│     │   ├─ 🟢 k8s-master    │
│     │   └─ 🟢 k8s-node-01   │
│     └─ 🟢 docker-standalone │
│                             │
│  ▼ 📁 中间件                │
│     ├─ 📂 Redis             │  ← 按中间件类型分组
│     │   ├─ 🟢 redis-prod    │
│     │   └─ ⚫ redis-test    │
│     ├─ 📂 Kafka             │
│     │   └─ ⚫ kafka-cluster │
│     └─ 📂 Elasticsearch     │
│         └─ ⚫ es-cluster    │
│                             │
└─────────────────────────────┘

添加菜单（点击 + 按钮）：
┌─────────────────────┐
│ 📄 新建连接          │
│ 📂 新建目录          │
└─────────────────────┘

连接右键菜单：
┌─────────────────────┐
│ 连接                │
│ 断开                │
│ ─────────────────── │
│ 编辑                │
│ 重命名              │
│ 复制                │
│ 删除                │
│ ─────────────────── │
│ 移动到...           │  ← 移动到其他目录
│ 在新窗口打开        │
└─────────────────────┘

目录右键菜单：
┌─────────────────────┐
│ 📄 新建连接          │
│ 📂 新建子目录        │
│ ─────────────────── │
│ 重命名              │
│ 删除                │  ← 删除目录（需确认，连接移至上级）
│ ─────────────────── │
│ 展开全部            │
│ 折叠全部            │
└─────────────────────┘

模块类型右键菜单（SSH连接/数据库/Docker/中间件）：
┌─────────────────────┐
│ 📄 新建连接          │
│ 📂 新建目录          │
│ ─────────────────── │
│ 展开全部            │
│ 折叠全部            │
│ ─────────────────── │
│ 排序方式            │ → 名称/状态/创建时间
└─────────────────────┘
```

**目录层级限制：**
- 最大嵌套深度：5层（模块类型不计入）
- 建议组织方式：按环境 > 区域 > 项目 > 用途

#### 3.6.2 标签页栏

```
┌────────────────────────────────────────────────────────────────────────┐
│ ┌──────────────────┐ ┌──────────────────┐ ┌──────────────────┐        │
│ │ 🟢 SSH:prod-01 × │ │ 🔵 MySQL:db-01 × │ │ 📁 SFTP:prod   × │  [ + ] │
│ └──────────────────┘ └──────────────────┘ └──────────────────┘        │
└────────────────────────────────────────────────────────────────────────┘

标签状态图标：
🟢 SSH终端（已连接）
⚫ SSH终端（已断开）
🔵 数据库
📁 SFTP
🐳 Docker
🔧 中间件

标签操作：
- 点击：切换标签
- 中键：关闭标签
- 拖拽：重排序
- 右键：关闭/关闭其他/关闭右侧/固定
```

#### 3.6.3 分屏布局

```
水平分屏：
┌────────────────────────────────┬────────────────────────────────┐
│                                │                                │
│         终端 1                 │         终端 2                  │
│                                │                                │
└────────────────────────────────┴────────────────────────────────┘

垂直分屏：
┌────────────────────────────────────────────────────────────────────┐
│                                                                    │
│                            终端 1                                  │
│                                                                    │
├────────────────────────────────────────────────────────────────────┤
│                                                                    │
│                            终端 2                                  │
│                                                                    │
└────────────────────────────────────────────────────────────────────┘

四宫格：
┌────────────────────────────────┬────────────────────────────────┐
│          终端 1                │          终端 2                 │
├────────────────────────────────┼────────────────────────────────┤
│          终端 3                │          终端 4                 │
└────────────────────────────────┴────────────────────────────────┘
```

---

## 4. 模块详细设计

### 4.1 SSH终端模块

#### 4.1.1 功能列表

| 功能 | 优先级 | 说明 |
|------|--------|------|
| SSH连接 | P0 | 密码/密钥/交互式验证 |
| 终端仿真 | P0 | xterm-256color，支持24位色 |
| 会话管理 | P0 | 多会话/重连/会话保持 |
| 跳板机 | P1 | ProxyJump支持 |
| 命令广播 | P1 | 多终端同步输入 |
| 历史记录 | P1 | 命令历史/会话日志 |
| SOCKS5代理 | P2 | 动态端口转发 |
| X11转发 | P2 | 图形界面转发 |
| ZMODEM | P2 | rz/sz文件传输 |

#### 4.1.2 连接配置界面

```
┌─────────────────────────────────────────────────────────────────────┐
│ 新建SSH连接                                                    [×] │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  连接名称：  [prod-server-01                    ]                  │
│                                                                     │
│  ── 基本设置 ────────────────────────────────────────────────────  │
│                                                                     │
│  主机：      [192.168.1.100                     ]                  │
│  端口：      [22                                ]                  │
│  用户名：    [root                              ]                  │
│                                                                     │
│  认证方式：  ◉ 密码  ○ 密钥  ○ 交互式                              │
│  密码：      [••••••••                          ] [👁]              │
│                                                                     │
│  ── 高级设置 ────────────────────────────────────────────────────  │
│                                                                     │
│  ▶ 跳板机设置                                                       │
│  ▶ 代理设置                                                         │
│  ▶ 终端设置                                                         │
│                                                                     │
│                                    [测试连接]  [取消]  [保存]      │
└─────────────────────────────────────────────────────────────────────┘
```

#### 4.1.3 终端界面

```
┌─────────────────────────────────────────────────────────────────────┐
│ 🟢 prod-server-01                                      [⋮] 更多操作 │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│ Last login: Mon Jan 15 10:30:00 2025 from 192.168.1.50             │
│ [root@prod-server-01 ~]# ls -la                                    │
│ total 48                                                            │
│ drwx------   6 root root 4096 Jan 15 10:30 .                       │
│ drwxr-xr-x  18 root root 4096 Jan 10 09:00 ..                      │
│ -rw-------   1 root root 1234 Jan 15 10:30 .bash_history           │
│ -rw-r--r--   1 root root  570 Jan 10 09:00 .bashrc                 │
│ drwxr-xr-x   2 root root 4096 Jan 10 09:00 .ssh                    │
│ [root@prod-server-01 ~]# █                                         │
│                                                                     │
│                                                                     │
│                                                                     │
│                                                                     │
│                                                                     │
│                                                                     │
│                                                                     │
├─────────────────────────────────────────────────────────────────────┤
│ ⌘C 复制  ⌘V 粘贴  ⌘F 搜索  ⌘S 快照  ⌘+ 放大  ⌘- 缩小       80×24 │
└─────────────────────────────────────────────────────────────────────┘

右上角更多操作菜单：
┌─────────────────────┐
│ 📋 复制会话         │
│ 📝 会话日志         │
│ 📺 录制会话         │
│ ─────────────────── │
│ ↔️ 水平分屏         │
│ ↕️ 垂直分屏         │
│ ─────────────────── │
│ 📡 命令广播         │
│ 🔄 重新连接         │
│ ─────────────────── │
│ ⚙️ 终端设置         │
└─────────────────────┘
```

#### 4.1.4 终端 + 文件面板集成界面

SSH终端页面支持右侧集成SFTP文件面板，实现终端操作与文件管理的无缝切换。

**布局说明：**
- 左侧：SSH终端区域
- 右侧：远程文件浏览面板（可折叠，默认隐藏）
- 点击工具栏的 [📁] 按钮切换文件面板显示

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│ 🟢 prod-server-01                                    [📁] [⋮] 更多操作          │
├─────────────────────────────────────────────┬───────────────────────────────────┤
│                                             │  📂 /home/root                     │
│ Last login: Mon Jan 15 10:30:00 2025       │  ───────────────────────────────── │
│ [root@prod-server-01 ~]# ls -la            │  [🔙] [🏠] [↻]          🔍 搜索    │
│ total 48                                   │  ───────────────────────────────── │
│ drwx------   6 root root 4096 Jan 15 10:30 │  名称          修改时间     大小   │
│ drwxr-xr-x  18 root root 4096 Jan 10 09:00 │  📁 etc       12-12 16:37   4KB   │
│ -rw-------   1 root root 1234 Jan 15 10:30 │  📁 tmp       12-14 00:59   380B  │
│ -rw-r--r--   1 root root  570 Jan 10 09:00 │  📁 usr       02-26 10:02   4KB   │
│ drwxr-xr-x   2 root root 4096 Jan 10 09:00 │  📁 var       02-26 16:45   4KB   │
│ [root@prod-server-01 ~]# █                 │  📁 home      12-13 23:16   4KB   │
│                                             │  📄 app.jar   01-15 08:00   45MB  │
│              SSH 终端区域                   │  📄 start.sh  01-15 08:00   1KB   │
│                                             │                                    │
│                                             │         远程文件面板               │
├─────────────────────────────────────────────┴───────────────────────────────────┤
│ ⌘C 复制  ⌘V 粘贴  ⌘F 搜索  ⌘S 快照  ⌘+ 放大  ⌘- 缩小                    80×24 │
├─────────────────────────────────────────────────────────────────────────────────┤
│ ─── 传输队列 ─────────────────────────────────────────────────────────────────  │
│ [▶] app.jar                上传   45MB   ████████████░░░░   80%   12MB/s       │
│ [⏸] logs.tar.gz            下载  120MB   ░░░░░░░░░░░░░░░░    0%   等待中       │
└─────────────────────────────────────────────────────────────────────────────────┘
```

**文件面板工具栏：**
- [🔙] 返回上级目录
- [🏠] 返回主目录
- [↻] 刷新当前目录
- 🔍 搜索文件

**文件右键菜单：**
```
┌───────────────────────────┐
│ 操作          ✂️ 剪切 📋 复制 │
├───────────────────────────┤
│ 📂 本地打开        Enter  │
│ 📝 在线编辑       ⌥⇧E    │
│ 🔄 刷新           F5     │
├───────────────────────────┤
│ ⬇️ 下载至...              │
│ ⬆️ 选择文件上传           │
│ 📁 选择文件夹上传         │
│ 📡 SCP传输          ▶    │
├───────────────────────────┤
│ 🗜️ 压缩                   │
│ 📦 解压缩                 │
├───────────────────────────┤
│ ✏️ 重命名          F2     │
│ 🗑️ 删除        Backspace  │
├───────────────────────────┤
│ ▼ 更多...                 │
│   📊 属性                 │
│   🔐 修改权限             │
│   👤 修改所有者           │
└───────────────────────────┘
```

**传输队列功能：**
- 显示当前上传/下载任务
- 支持暂停、继续、取消操作
- 显示传输进度、速度
- 队列任务管理

### 4.2 SFTP文件管理模块

#### 4.2.1 功能列表

| 功能 | 优先级 | 说明 |
|------|--------|------|
| 远程文件浏览 | P0 | 目录树/列表视图 |
| 文件上传下载 | P0 | 拖拽支持/批量操作 |
| 本地文件浏览 | P0 | 与远程对照 |
| 文件编辑 | P1 | 内置编辑器/外部打开 |
| 权限修改 | P1 | chmod/chown |
| SUDO提权 | P2 | 提升权限访问 |
| 服务器互传 | P2 | 直接在服务器间传输 |

#### 4.2.2 SFTP界面

```
┌─────────────────────────────────────────────────────────────────────┐
│ 📁 SFTP: prod-server-01                                    [⋮]     │
├─────────────────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────┬─────────────────────────────────┐  │
│ │       本地文件              │         远程文件                 │  │
│ ├─────────────────────────────┼─────────────────────────────────┤  │
│ │ 📂 /Users/dev/projects      │ 📂 /home/deploy/app              │  │
│ │ ─────────────────────────── │ ─────────────────────────────── │  │
│ │ [🔙] [🏠] [↻]    🔍 搜索    │ [🔙] [🏠] [↻]    🔍 搜索        │  │
│ │ ─────────────────────────── │ ─────────────────────────────── │  │
│ │ 名称           大小   修改  │ 名称           大小   修改   权限│  │
│ │ 📁 src         -     14:30 │ 📁 logs        -     10:00  755 │  │
│ │ 📁 dist        -     14:20 │ 📁 config      -     09:30  755 │  │
│ │ 📄 package.json 2KB  14:30 │ 📄 app.jar   45MB   08:00  644 │  │
│ │ 📄 README.md   5KB  14:00  │ 📄 start.sh   1KB   08:00  755 │  │
│ │                             │                                  │  │
│ │                             │                                  │  │
│ └─────────────────────────────┴─────────────────────────────────┘  │
│                                                                     │
│ ─── 传输队列 ─────────────────────────────────────────────────────  │
│ │ [▶] app.jar               上传  45MB  ████████░░░░  80%  12MB/s │  │
│ │ [⏸] logs.tar.gz           下载 120MB  ░░░░░░░░░░░░   0%  等待中 │  │
│ └────────────────────────────────────────────────────────────────  │
└─────────────────────────────────────────────────────────────────────┘
```

### 4.3 数据库管理模块

#### 4.3.1 功能列表

| 功能 | 优先级 | 说明 |
|------|--------|------|
| 连接管理 | P0 | MySQL/PostgreSQL/SQLite |
| SQL编辑器 | P0 | Monaco Editor，语法高亮/自动补全 |
| SQL格式化/压缩 | P0 | 美化SQL/压缩为单行 |
| 查询执行 | P0 | 运行全部/执行选中/停止 |
| 执行计划 | P0 | EXPLAIN分析SQL执行计划 |
| 查询结果展示 | P0 | 表格展示/分页/排序 |
| 数据库对象树 | P0 | 表/视图/物化视图/函数/保存的查询 |
| 表浏览编辑 | P0 | 数据内联编辑 |
| 表结构管理 | P1 | 查看DDL/创建/修改/删除表 |
| SSH代理 | P1 | 通过SSH隧道连接 |
| 数据导入导出 | P1 | CSV/Excel/JSON/SQL INSERT |
| 保存查询 | P1 | 保存常用SQL到查询列表 |
| 实时监控 | P2 | 连接数/QPS/慢查询 |

#### 4.3.2 数据库连接配置

```
┌─────────────────────────────────────────────────────────────────────┐
│ 新建数据库连接                                                  [×] │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  连接名称：  [prod-mysql-01                     ]                  │
│                                                                     │
│  数据库类型：  ◉ MySQL  ○ PostgreSQL  ○ SQLite                     │
│                                                                     │
│  ── 连接设置 ────────────────────────────────────────────────────  │
│                                                                     │
│  主机：      [192.168.1.200                     ]                  │
│  端口：      [3306                              ]                  │
│  用户名：    [root                              ]                  │
│  密码：      [••••••••                          ] [👁]              │
│  数据库：    [production                        ] (可选)           │
│                                                                     │
│  ── SSH隧道 ────────────────────────────────────────────────────   │
│                                                                     │
│  [✓] 使用SSH隧道                                                    │
│  SSH主机：  [192.168.1.100                      ]                  │
│  SSH端口：  [22                                 ]                  │
│  SSH用户：  [root                               ]                  │
│  认证方式：  ◉ 密码  ○ 密钥                                        │
│                                                                     │
│                                    [测试连接]  [取消]  [保存]      │
└─────────────────────────────────────────────────────────────────────┘
```

#### 4.3.3 数据库对象树

**数据库Schema结构：**
- 每个数据库下包含以下对象类型，显示对象数量
- 支持展开/折叠，点击对象可查看详情

```
┌─────────────────────────────────────┐
│ 📁 production                        │
│   ▶ 📋 表              [15]          │  ← Tables，展开显示所有表
│   ▶ 👁 视图            [3]           │  ← Views
│   ▶ 📊 物化视图        [2]           │  ← Materialized Views (PostgreSQL)
│   ▶ ƒx 函数            [8]           │  ← Functions/Stored Procedures
│   ▶ 📝 查询            [5]           │  ← Saved Queries (用户保存的SQL)
└─────────────────────────────────────┘

展开"表"后：
┌─────────────────────────────────────┐
│ 📁 production                        │
│   ▼ 📋 表              [15]          │
│       📄 users                       │
│       📄 orders                      │
│       📄 products                    │
│       📄 categories                  │
│       ...                            │
│   ▶ 👁 视图            [3]           │
│   ...                                │
└─────────────────────────────────────┘

表分类右键菜单（右键点击"📋 表 [15]"）：
┌─────────────────────────┐
│ 📝 新建查询             │  ← 打开空白SQL编辑器
│ ➕ 新建表               │  ← 打开建表对话框
└─────────────────────────┘

表右键菜单：
┌─────────────────────────┐
│ 📝 新建查询             │  ← 基于此表新建SQL（SELECT * FROM table）
│ ✏️ 编辑数据             │  ← 打开表数据编辑器
│ ─────────────────────── │
│ 📋 查看DDL              │  ← SHOW CREATE TABLE
│ ─────────────────────── │
│ ➕ 新建表               │  ← 打开建表对话框
│ 🔧 编辑表结构           │  ← 修改列、索引、约束等
│ ✏️ 修改表名             │  ← 重命名表
│ ─────────────────────── │
│ 📄 复制表名             │
│ ─────────────────────── │
│ 🗑️ 删除表              │  ← DROP TABLE（需确认）
└─────────────────────────┘
```

#### 4.3.4 表结构管理

##### 新建表对话框

采用行内编辑模式，所有字段直接在表格行中修改，支持 Tab 切换不同配置项。

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│ 新建表 - database_name                                                          [×] │
├─────────────────────────────────────────────────────────────────────────────────────┤
│  表名：[users              ]    表注释：[用户表              ]                      │
├─────────────────────────────────────────────────────────────────────────────────────┤
│ [💾 创建]   [+ 添加]                                                                │
├─────────────────────────────────────────────────────────────────────────────────────┤
│ │ 列 │ 索引 │ 外键 │ 约束 │ 触发器 │ 高级 │                                         │
├─────────────────────────────────────────────────────────────────────────────────────┤
│  │ 列名         │ 类型       │ 长度  │ NN │ PK │ AI │ 默认值   │ 注释      │ 操作 │
│  ├──────────────┼────────────┼───────┼────┼────┼────┼──────────┼───────────┼──────│
│  │ [id        ] │ [INT    ▼] │ [   ] │ ☑  │ ☑  │ ☑  │ [      ] │ [主键   ] │ [🗑] │
│  │ [username  ] │ [VARCHAR▼] │ [50 ] │ ☑  │ ☐  │ ☐  │ [      ] │ [用户名 ] │ [🗑] │
│  │ [email     ] │ [VARCHAR▼] │ [255] │ ☑  │ ☐  │ ☐  │ [      ] │ [邮箱   ] │ [🗑] │
│  │ [created_at] │ [DATETIME] │ [   ] │ ☐  │ ☐  │ ☐  │ [NOW() ] │ [创建时间]│ [🗑] │
│  └──────────────────────────────────────────────────────────────────────────────────│
│                                                                                     │
│  ▶ SQL预览                                                                         │
│  ┌────────────────────────────────────────────────────────────────────────────────┐│
│  │ CREATE TABLE `database_name`.`users` (                                         ││
│  │   `id` INT NOT NULL AUTO_INCREMENT COMMENT '主键',                             ││
│  │   `username` VARCHAR(50) NOT NULL COMMENT '用户名',                            ││
│  │   ...                                                                          ││
│  │ ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;                                       ││
│  └────────────────────────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────────────────────────┘
```

**Tab页功能：**
- **列**：行内编辑列名、类型、长度、非空(NN)、主键(PK)、自增(AI)、默认值、注释
- **索引**：行内编辑索引名、类型（普通/唯一）、方法（BTREE/HASH）、列选择（标签式多选）
- **外键**：行内编辑外键名、本表列、引用表、引用列、ON DELETE、ON UPDATE
- **约束**：行内编辑约束名、CHECK表达式
- **触发器**：卡片式布局，每个触发器包含名称、时机、事件、语句
- **高级**：引擎选择、字符集选择

##### 编辑表结构对话框

采用行内编辑模式，与新建表对话框交互方式一致。

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│ 编辑表结构 - users                                                              [×] │
├─────────────────────────────────────────────────────────────────────────────────────┤
│ [💾 应用]   [+ 添加]                                                                │
├─────────────────────────────────────────────────────────────────────────────────────┤
│ │ 列 │ 索引 │ 外键 │ 约束 │ 触发器 │ 高级 │                                         │
├─────────────────────────────────────────────────────────────────────────────────────┤
│  │ 列名         │ 类型       │ 长度  │ NN │ AI │ 默认值   │ 注释      │ 操作       │
│  ├──────────────┼────────────┼───────┼────┼────┼──────────┼───────────┼────────────│
│  │ [id        ] │ INT        │ [   ] │ ☑  │ ☑  │ [      ] │ [主键   ] │ [🗑]       │
│  │ [username  ] │ VARCHAR    │ [50 ] │ ☑  │ ☐  │ [      ] │ [用户名 ] │ [🗑]  (修改)│
│  │ [phone     ] │ VARCHAR    │ [20 ] │ ☐  │ ☐  │ [NULL  ] │ [电话   ] │ [🗑]  (新增)│
│  │ ~~deleted~~ │ ~~VARCHAR~~│~~255~~│    │    │          │           │ [↩]  (删除)│
│  └──────────────────────────────────────────────────────────────────────────────────│
│                                                                                     │
│  ▶ 变更预览                                                                        │
│  ┌────────────────────────────────────────────────────────────────────────────────┐│
│  │ ALTER TABLE `users` MODIFY COLUMN `username` VARCHAR(50) NOT NULL;             ││
│  │ ALTER TABLE `users` ADD COLUMN `phone` VARCHAR(20) NULL;                       ││
│  │ ALTER TABLE `users` DROP COLUMN `deleted`;                                     ││
│  └────────────────────────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────────────────────────┘
```

**行状态标识：**
- 绿色背景：新增行
- 黄色背景：已修改行
- 删除线+半透明：标记删除的行（点击↩可恢复）

**已有数据编辑限制：**
- 列类型：已有列不可修改类型（避免数据丢失）
- 索引/外键/约束/触发器：已有项只能删除，不能修改

**字段标签页功能：**
- 复选框列：用于批量选择字段进行删除
- 字段列：字段名称，可直接编辑
- 类型列：数据类型下拉选择
- 长度列：类型长度（如VARCHAR(255)）
- 小数位列：DECIMAL等类型的小数位数
- 允许空列：是否允许NULL
- 主键列：是否为主键（🔑图标，数字表示复合主键顺序）
- 注释列：字段注释

**右侧详情面板：**
- 字段名：编辑字段名称
- 注释：字段注释
- 默认值：NULL或自定义值（单选按钮切换）
- 自动生成：无/AUTO_INCREMENT/UUID等（下拉选择）

**索引标签页：**
```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│ │ 字段 │ 索引 │ 外键 │ 约束检查 │ 触发器 │ 高级 │                                   │
├───────────────────────────────────────────────────────────────────┬─────────────────┤
│                                                                   │                 │
│  │   │ 索引名         │ 类型     │ 列              │ 方法       │ │  索引名         │
│  ├───┼────────────────┼──────────┼─────────────────┼────────────┤ │  [idx_user   ]  │
│  │ ☐ │ PRIMARY        │ 主键     │ id              │ BTREE      │ │                 │
│  │ ☐ │ idx_username   │ 唯一     │ username        │ BTREE      │ │  类型           │
│  │ ☐ │ idx_email      │ 普通     │ email           │ BTREE      │ │  [普通索引 ▼]  │
│  │ ☐ │ idx_created    │ 普通     │ created_at      │ BTREE      │ │                 │
│  └───┴────────────────┴──────────┴─────────────────┴────────────┘ │  索引列         │
│                                                                   │  ☑ username     │
│                                                                   │  ☐ email        │
│                                                                   │  ☐ created_at   │
│                                                                   │                 │
│                                                                   │  索引方法       │
│                                                                   │  [BTREE    ▼]  │
└───────────────────────────────────────────────────────────────────┴─────────────────┘
```

**外键标签页：**
```
│  │   │ 外键名              │ 列       │ 参照表   │ 参照列     │ 删除规则    │ 更新规则    │
│  ├───┼─────────────────────┼──────────┼──────────┼────────────┼─────────────┼─────────────│
│  │ ☐ │ fk_user_role        │ role_id  │ roles    │ id         │ CASCADE     │ CASCADE     │
```

**约束检查标签页（CHECK约束）：**
```
│  │   │ 约束名              │ 表达式                                           │
│  ├───┼─────────────────────┼──────────────────────────────────────────────────│
│  │ ☐ │ chk_points          │ points >= 0                                      │
│  │ ☐ │ chk_status          │ status IN ('active', 'inactive', 'banned')       │
```

**触发器标签页：**
```
│  │   │ 触发器名            │ 事件     │ 时机     │ 状态     │
│  ├───┼─────────────────────┼──────────┼──────────┼──────────│
│  │ ☐ │ trg_update_time     │ UPDATE   │ BEFORE   │ 启用     │
│  │ ☐ │ trg_log_insert      │ INSERT   │ AFTER    │ 启用     │
```

**高级标签页：**
- 表引擎选择：InnoDB / MyISAM / MEMORY 等
- 字符集选择：utf8mb4 / utf8 / latin1 等
- 排序规则选择
- 表注释
- 自增起始值
- 行格式：COMPACT / DYNAMIC / COMPRESSED

**工具栏按钮：**
- 应用：执行所有变更（保存）
- 添加：添加新字段/索引（根据当前标签页）
- 删除：删除选中的字段/索引

##### 修改表名对话框

```
┌─────────────────────────────────────────────────────────────────────┐
│ 修改表名                                                        [×] │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  当前表名：  users                                                  │
│  新表名：    [users_new                        ]                    │
│                                                                     │
│  ── 预览SQL ───────────────────────────────────────────────────────│
│  │ RENAME TABLE `users` TO `users_new`;                            │
│  └───────────────────────────────────────────────────────────────── │
│                                                                     │
│  ⚠️ 警告：重命名表可能会影响依赖此表的视图、存储过程和应用程序。   │
│                                                                     │
│                                        [取消]  [确认重命名]        │
└─────────────────────────────────────────────────────────────────────┘
```

#### 4.3.5 SQL编辑器界面

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│ 🔵 MySQL: prod-mysql-01                                                   [⋮]   │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│ ┌───────────────┐ ┌─────────────────────────────────────────────────────────┐  │
│ │ 📁 production  │ │  [public ▼]  [▶ 运行全部(⌘+Enter)] [执行计划] [格式化]  │  │
│ │  ▶ 📋 表  [15]│ │              [压缩] [导出 ▼] [💾 保存(⌘+S)]            │  │
│ │  ▶ 👁 视图 [3]│ ├─────────────────────────────────────────────────────────┤  │
│ │  ▶ 📊 物化 [2]│ │ 1│ -- 查询用户订单                                      │  │
│ │  ▶ ƒx 函数 [8]│ │ 2│ SELECT                                               │  │
│ │  ▶ 📝 查询 [5]│ │ 3│   u.id,                                              │  │
│ │               │ │ 4│   u.name,                                            │  │
│ │               │ │ 5│   COUNT(o.id) as order_count                         │  │
│ │               │ │ 6│ FROM users u                                         │  │
│ │               │ │ 7│ LEFT JOIN orders o ON u.id = o.user_id               │  │
│ │               │ │ 8│ GROUP BY u.id                                        │  │
│ │               │ │ 9│ LIMIT 100;                                           │  │
│ │               │ │  │                                                      │  │
│ └───────────────┘ └─────────────────────────────────────────────────────────┘  │
│                                                                                 │
│ ─────────────────────────────────────────────────────────────────────────────── │
│ │ 结果 (1000行) │ 消息 │ 执行计划 │                                          │ │
│ ├───────────────────────────────────────────────────────────────────────────── │
│ │ id    │ name        │ order_count                                          │ │
│ │ 1     │ 张三        │ 15                                                   │ │
│ │ 2     │ 李四        │ 8                                                    │ │
│ │ 3     │ 王五        │ 23                                                   │ │
│ │ ...   │ ...         │ ...                                                  │ │
│ └─────────────────────────────────────────────────────────────────────────────  │
│ 执行时间: 0.023s  │  影响行数: 1000  │  第1-50行 / 共1000行                    │
└─────────────────────────────────────────────────────────────────────────────────┘

工具栏说明：
┌────────────────┬──────────────────────────────────────────────────────────────┐
│ 功能           │ 说明                                                         │
├────────────────┼──────────────────────────────────────────────────────────────┤
│ [数据库选择 ▼] │ 下拉选择当前使用的数据库（Schema）                           │
│ ▶ 运行全部     │ 执行编辑器中所有SQL语句 (⌘+Enter / Ctrl+Enter)             │
│ 执行计划       │ EXPLAIN分析SQL执行计划                                       │
│ 格式化         │ SQL语句格式化美化                                            │
│ 压缩           │ 将SQL压缩为单行（去除空格换行）                              │
│ 导出 ▼        │ 导出查询结果：CSV、Excel、JSON、SQL INSERT                   │
│ 💾 保存        │ 保存当前SQL到"查询"列表 (⌘+S / Ctrl+S)                      │
└────────────────┴──────────────────────────────────────────────────────────────┘

导出菜单：
┌─────────────────────┐
│ 📄 导出为CSV        │
│ 📊 导出为Excel      │
│ 📋 导出为JSON       │
│ 📝 导出为SQL INSERT │
│ ─────────────────── │
│ ⚙️ 导出设置...      │
└─────────────────────┘
```

### 4.4 Docker管理模块

#### 4.4.1 功能列表

| 功能 | 优先级 | 说明 |
|------|--------|------|
| 容器列表 | P0 | 运行状态/操作 |
| 镜像管理 | P0 | 列表/拉取/删除 |
| 容器日志 | P0 | 实时日志/历史日志 |
| 容器终端 | P0 | exec进入容器 |
| Docker Compose | P1 | 编辑/启动/停止 |
| 资源监控 | P1 | CPU/内存/网络 |
| 镜像仓库 | P2 | 自定义仓库配置 |

#### 4.4.2 Docker管理界面

```
┌─────────────────────────────────────────────────────────────────────┐
│ 🐳 Docker: docker-host-01                                   [⋮]    │
├─────────────────────────────────────────────────────────────────────┤
│ │ 容器 │ 镜像 │ 网络 │ 卷 │ Compose │                              │
├─────────────────────────────────────────────────────────────────────┤
│ 🔍 搜索容器...                          [▼ 全部] [↻ 刷新]           │
├─────────────────────────────────────────────────────────────────────┤
│ │ 状态 │ 名称           │ 镜像          │ 端口        │ 操作      │ │
│ ├──────┼────────────────┼───────────────┼─────────────┼───────────┤ │
│ │ 🟢   │ nginx-proxy    │ nginx:latest  │ 80,443→80   │ [⋮]      │ │
│ │ 🟢   │ web-app        │ myapp:v1.2    │ 8080→8080   │ [⋮]      │ │
│ │ 🟢   │ mysql-master   │ mysql:8.0     │ 3306→3306   │ [⋮]      │ │
│ │ 🔴   │ redis-cache    │ redis:7       │ 6379→6379   │ [⋮]      │ │
│ │ 🟢   │ kafka-1        │ kafka:3.7     │ 9092→9092   │ [⋮]      │ │
│ └──────┴────────────────┴───────────────┴─────────────┴───────────┘ │
│                                                                     │
│ ─── 容器详情: nginx-proxy ───────────────────────────────────────  │
│ │ 概览 │ 日志 │ 终端 │ 监控 │ 配置 │                               │
│ ├─────────────────────────────────────────────────────────────────  │
│ │ [实时日志]                                            [下载日志] │ │
│ │ 2025/01/15 10:30:00 [notice] 1#1: nginx/1.24.0                  │ │
│ │ 2025/01/15 10:30:00 [notice] 1#1: built by gcc 12.2.0           │ │
│ │ 2025/01/15 10:30:01 192.168.1.50 - GET / HTTP/1.1 200           │ │
│ │ 2025/01/15 10:30:02 192.168.1.51 - GET /api HTTP/1.1 200        │ │
│ └─────────────────────────────────────────────────────────────────  │
└─────────────────────────────────────────────────────────────────────┘

容器操作菜单 [⋮]：
┌─────────────────────┐
│ ▶️ 启动             │
│ ⏹️ 停止             │
│ 🔄 重启             │
│ ─────────────────── │
│ 📋 查看日志         │
│ 💻 进入终端         │
│ 📊 资源监控         │
│ ─────────────────── │
│ ⚙️ 查看配置         │
│ 🗑️ 删除             │
└─────────────────────┘
```

### 4.5 中间件管理模块

#### 4.5.1 Redis管理

```
┌─────────────────────────────────────────────────────────────────────┐
│ 🔴 Redis: redis-cluster                                     [⋮]    │
├─────────────────────────────────────────────────────────────────────┤
│ │ 概览 │ Keys │ 终端 │ 配置 │ 监控 │                               │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│ ── 集群状态 ─────────────────────────────────────────────────────  │
│ │ 节点数: 6  │  主节点: 3  │  从节点: 3  │  状态: 🟢 健康          │ │
│                                                                     │
│ ── Key浏览器 ────────────────────────────────────────────────────  │
│ │ 🔍 搜索Key...  │  [全部] [String] [Hash] [List] [Set] [ZSet]   │ │
│ ├───────────────────────────────────────────────────────────────── │
│ │ Key名称                    │ 类型   │ TTL    │ 大小   │ 操作   │ │
│ ├────────────────────────────┼────────┼────────┼────────┼────────┤ │
│ │ user:1001                  │ Hash   │ 3600s  │ 256B   │ [⋮]   │ │
│ │ session:abc123             │ String │ 1800s  │ 128B   │ [⋮]   │ │
│ │ cache:product:list         │ List   │ -1     │ 4.2KB  │ [⋮]   │ │
│ │ hot:keywords               │ ZSet   │ -1     │ 1.1KB  │ [⋮]   │ │
│ └───────────────────────────────────────────────────────────────── │
│                                                                     │
│ ── Key详情: user:1001 ───────────────────────────────────────────  │
│ │ 类型: Hash  │  TTL: 3600s  │  编码: ziplist                     │ │
│ │                                                                  │ │
│ │ Field        │ Value                                            │ │
│ │ ─────────────┼────────────────────────────────────────────────  │ │
│ │ name         │ 张三                                             │ │
│ │ email        │ zhangsan@example.com                             │ │
│ │ age          │ 28                                               │ │
│ │ created_at   │ 2025-01-15 10:30:00                              │ │
│ │                                              [编辑] [删除] [刷新] │
│ └─────────────────────────────────────────────────────────────────  │
└─────────────────────────────────────────────────────────────────────┘
```

#### 4.5.2 Kafka管理

```
┌─────────────────────────────────────────────────────────────────────┐
│ 📨 Kafka: kafka-cluster                                     [⋮]    │
├─────────────────────────────────────────────────────────────────────┤
│ │ 概览 │ Topics │ 消费组 │ Broker │ 配置 │                         │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│ ── Topics ───────────────────────────────────────────────────────  │
│ │ 🔍 搜索Topic...                               [+ 新建Topic]     │ │
│ ├───────────────────────────────────────────────────────────────── │
│ │ Topic名称         │ 分区 │ 副本 │ 消息数    │ 大小    │ 操作   │ │
│ ├────────────────────┼──────┼──────┼───────────┼─────────┼────────┤ │
│ │ order-events      │ 12   │ 3    │ 1.2M     │ 2.5GB   │ [⋮]   │ │
│ │ user-activity     │ 6    │ 3    │ 856K     │ 1.1GB   │ [⋮]   │ │
│ │ system-logs       │ 3    │ 2    │ 2.3M     │ 4.2GB   │ [⋮]   │ │
│ └───────────────────────────────────────────────────────────────── │
│                                                                     │
│ ── Topic详情: order-events ──────────────────────────────────────  │
│ │ 分区 │ 消息 │ 消费组 │ 配置 │                                    │ │
│ ├─────────────────────────────────────────────────────────────────  │
│ │ 消息浏览                                                         │ │
│ │ 分区: [全部 ▼]  偏移量: [Latest ▼]  条数: [100]   [🔍 搜索]     │ │
│ ├─────────────────────────────────────────────────────────────────  │
│ │ Offset   │ 时间                │ Key      │ Value                │ │
│ │ 1234567  │ 2025-01-15 10:30:00 │ order123 │ {"order_id":"123"... │ │
│ │ 1234566  │ 2025-01-15 10:29:58 │ order122 │ {"order_id":"122"... │ │
│ │ 1234565  │ 2025-01-15 10:29:55 │ order121 │ {"order_id":"121"... │ │
│ └─────────────────────────────────────────────────────────────────  │
└─────────────────────────────────────────────────────────────────────┘
```

#### 4.5.3 Elasticsearch管理

```
┌─────────────────────────────────────────────────────────────────────┐
│ 🔍 Elasticsearch: es-cluster                                [⋮]    │
├─────────────────────────────────────────────────────────────────────┤
│ │ 概览 │ 索引 │ 查询 │ 节点 │ 配置 │                               │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│ ── 集群状态 ─────────────────────────────────────────────────────  │
│ │ 状态: 🟢 green  │  节点: 5  │  索引: 23  │  文档: 12.5M         │ │
│                                                                     │
│ ── 索引管理 ─────────────────────────────────────────────────────  │
│ │ 🔍 搜索索引...                                  [+ 新建索引]    │ │
│ ├───────────────────────────────────────────────────────────────── │
│ │ 索引名称           │ 状态 │ 文档数   │ 大小    │ 分片 │ 操作   │ │
│ ├─────────────────────┼──────┼──────────┼─────────┼──────┼────────┤ │
│ │ logs-2025.01.15    │ 🟢   │ 2.5M    │ 3.2GB   │ 5/1  │ [⋮]   │ │
│ │ products           │ 🟢   │ 150K    │ 256MB   │ 3/1  │ [⋮]   │ │
│ │ users              │ 🟢   │ 50K     │ 128MB   │ 3/1  │ [⋮]   │ │
│ └───────────────────────────────────────────────────────────────── │
│                                                                     │
│ ── 查询控制台 ───────────────────────────────────────────────────  │
│ │ GET /logs-*/_search                                              │ │
│ │ {                                                                 │ │
│ │   "query": {                                                      │ │
│ │     "match": {                                                    │ │
│ │       "level": "error"                                           │ │
│ │     }                                                             │ │
│ │   }                                                               │ │
│ │ }                                                                 │ │
│ │                                              [▶ 执行] [📋 格式化] │ │
│ └─────────────────────────────────────────────────────────────────  │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 5. 开发任务分解

### 5.1 第一阶段任务列表

#### Sprint 1: 基础框架 (2周)

| 任务ID | 任务描述 | 模块 | 状态 |
|--------|----------|------|------|
| S1-001 | 初始化Tauri + React项目 | 基础 | TODO |
| S1-002 | 配置TypeScript + TailwindCSS | 基础 | TODO |
| S1-003 | 实现主布局框架（侧边栏+主区域+状态栏） | UI | TODO |
| S1-004 | 实现标签页管理组件 | UI | TODO |
| S1-005 | 实现分屏组件 | UI | TODO |
| S1-006 | 实现主题系统（暗色/亮色） | UI | TODO |
| S1-007 | 实现连接树组件（支持目录层级） | UI | TODO |
| S1-008 | 实现目录的创建/重命名/删除 | UI | TODO |
| S1-009 | 实现连接和目录的拖拽排序/移动 | UI | TODO |
| S1-010 | 设计连接与目录数据结构 | 后端 | TODO |
| S1-011 | 实现连接配置的加密存储 | 后端 | TODO |
| S1-012 | 实现配置导入导出（含目录结构） | 后端 | TODO |

#### Sprint 2: SSH终端 (2周)

| 任务ID | 任务描述 | 模块 | 状态 |
|--------|----------|------|------|
| S2-001 | 集成xterm.js终端组件 | 前端 | DONE |
| S2-002 | 实现Rust SSH客户端（russh） | 后端 | DONE |
| S2-003 | 实现SSH密码认证 | 后端 | DONE |
| S2-004 | 实现SSH密钥认证 | 后端 | DONE |
| S2-005 | 实现SSH会话管理 | 后端 | DONE |
| S2-006 | 前后端SSH数据流打通 | 集成 | DONE |
| S2-007 | 实现终端复制粘贴 | 前端 | DONE |
| S2-008 | 实现终端搜索 | 前端 | DONE |
| S2-009 | 实现终端字体/大小设置 | 前端 | DONE |
| S2-010 | 实现SSH连接配置界面 | 前端 | DONE |
| S2-011 | 实现会话断开重连 | 后端 | DONE |
| S2-012 | 实现跳板机支持 | 后端 | DONE |

#### Sprint 3: SFTP文件管理 (2周)

| 任务ID | 任务描述 | 模块 | 状态 |
|--------|----------|------|------|
| S3-001 | 实现SFTP客户端 | 后端 | DONE |
| S3-002 | 实现远程文件列表 | 后端 | DONE |
| S3-003 | 实现本地文件列表 | 前端 | DONE |
| S3-004 | 实现双栏文件浏览器界面 | 前端 | DONE |
| S3-005 | 实现文件上传（单文件） | 集成 | DONE |
| S3-006 | 实现文件下载（单文件） | 集成 | DONE |
| S3-007 | 实现批量上传下载 | 集成 | DONE |
| S3-008 | 实现拖拽上传下载 | 前端 | DONE |
| S3-009 | 实现传输进度显示 | 前端 | DONE |
| S3-010 | 实现传输队列管理 | 前端 | DONE |
| S3-011 | 实现文件权限修改 | 后端 | DONE |
| S3-012 | 实现文件编辑（内置编辑器） | 前端 | DONE |

#### Sprint 4: 数据库管理 (3周)

| 任务ID | 任务描述 | 模块 | 状态 |
|--------|----------|------|------|
| S4-001 | 实现MySQL连接 | 后端 | DONE |
| S4-002 | 实现PostgreSQL连接 | 后端 | TODO |
| S4-003 | 实现SQLite连接 | 后端 | TODO |
| S4-004 | 实现SSH隧道代理连接 | 后端 | TODO |
| S4-005 | 集成Monaco Editor | 前端 | DONE |
| S4-006 | 实现SQL语法高亮 | 前端 | DONE |
| S4-007 | 实现SQL自动补全 | 前端 | DONE |
| S4-008 | 实现SQL格式化 | 前端 | TODO |
| S4-009 | 实现SQL执行 | 集成 | DONE |
| S4-010 | 实现查询结果展示 | 前端 | DONE |
| S4-011 | 实现数据库Schema树浏览（数据库列表） | 前端 | DONE |
| S4-012 | 实现表结构查看（列/索引） | 后端 | DONE |
| S4-013 | 实现表数据内联编辑 | 前端 | TODO |
| S4-014 | 实现查询结果导出（CSV/Excel/JSON） | 前端 | TODO |
| S4-015 | 实现连接池管理 | 后端 | DONE |
| S4-016 | 实现视图列表获取 | 后端 | TODO |
| S4-017 | 实现物化视图列表获取（PostgreSQL） | 后端 | TODO |
| S4-018 | 实现函数/存储过程列表获取 | 后端 | TODO |
| S4-019 | 实现保存查询功能 | 前端 | TODO |
| S4-020 | 实现执行计划（EXPLAIN） | 集成 | TODO |
| S4-021 | 实现SQL压缩功能 | 前端 | TODO |
| S4-022 | 实现数据库选择下拉框 | 前端 | TODO |
| S4-023 | 实现表右键菜单（查看数据/DDL/删除） | 前端 | DONE |
| S4-024 | 实现Schema对象数量统计显示 | 前端 | DONE |
| S4-025 | 实现新建表对话框（列定义、索引、外键、约束、触发器、高级选项） | 前端 | DONE |
| S4-026 | 实现后端CREATE TABLE接口 | 后端 | TODO |
| S4-027 | 实现编辑表结构对话框（修改列、索引、外键、约束、触发器） | 前端 | DONE |
| S4-028 | 实现后端ALTER TABLE接口 | 后端 | TODO |
| S4-029 | 实现修改表名对话框 | 前端 | TODO |
| S4-030 | 实现后端RENAME TABLE接口 | 后端 | TODO |

#### Sprint 5: Docker管理 (2周)

| 任务ID | 任务描述 | 模块 | 状态 |
|--------|----------|------|------|
| S5-001 | 实现Docker API客户端（bollard） | 后端 | TODO |
| S5-002 | 实现SSH代理的Docker连接 | 后端 | TODO |
| S5-003 | 实现容器列表展示 | 前端 | TODO |
| S5-004 | 实现容器操作（启动/停止/重启/删除） | 集成 | TODO |
| S5-005 | 实现容器日志查看 | 集成 | TODO |
| S5-006 | 实现容器终端（exec） | 集成 | TODO |
| S5-007 | 实现镜像列表展示 | 前端 | TODO |
| S5-008 | 实现镜像操作（拉取/删除/导出） | 集成 | TODO |
| S5-009 | 实现容器资源监控 | 后端 | TODO |
| S5-010 | 实现Docker Compose文件编辑 | 前端 | TODO |

#### Sprint 6: 中间件管理 (3周)

| 任务ID | 任务描述 | 模块 | 状态 |
|--------|----------|------|------|
| S6-001 | 实现Redis客户端 | 后端 | TODO |
| S6-002 | 实现Redis集群信息展示 | 前端 | TODO |
| S6-003 | 实现Redis Key浏览器 | 前端 | TODO |
| S6-004 | 实现Redis Key操作（增删改查） | 集成 | TODO |
| S6-005 | 实现Redis命令行终端 | 前端 | TODO |
| S6-006 | 实现Kafka客户端 | 后端 | TODO |
| S6-007 | 实现Kafka Topic管理 | 前端 | TODO |
| S6-008 | 实现Kafka消息浏览 | 前端 | TODO |
| S6-009 | 实现Kafka消费组监控 | 前端 | TODO |
| S6-010 | 实现Elasticsearch客户端 | 后端 | TODO |
| S6-011 | 实现ES索引管理 | 前端 | TODO |
| S6-012 | 实现ES查询控制台 | 前端 | TODO |

#### Sprint 7: 完善与测试 (2周)

| 任务ID | 任务描述 | 模块 | 状态 |
|--------|----------|------|------|
| S7-001 | 多窗口支持 | 前端 | TODO |
| S7-002 | 快捷键系统 | 前端 | TODO |
| S7-003 | 国际化框架（中/英） | 前端 | TODO |
| S7-004 | 错误处理与用户提示优化 | 全局 | TODO |
| S7-005 | 性能优化 | 全局 | TODO |
| S7-006 | 跨平台测试（Windows） | 测试 | TODO |
| S7-007 | 跨平台测试（macOS） | 测试 | TODO |
| S7-008 | 跨平台测试（Linux） | 测试 | TODO |
| S7-009 | 打包发布配置 | 发布 | TODO |
| S7-010 | 用户文档编写 | 文档 | TODO |

### 5.2 里程碑

| 里程碑 | 目标 | 交付物 |
|--------|------|--------|
| M1 | 基础框架完成 | 可运行的空壳应用 |
| M2 | SSH终端可用 | 可连接服务器执行命令 |
| M3 | SFTP可用 | 可上传下载文件 |
| M4 | 数据库可用 | 可执行SQL查询 |
| M5 | Docker可用 | 可管理容器和镜像 |
| M6 | 中间件可用 | 可管理Redis/Kafka/ES |
| M7 | MVP发布 | 可安装的完整应用 |

---

## 6. 驱动/插件机制设计

### 6.1 插件目录结构

```
~/.zwd-opsbot/drivers/
├── mysql/
│   ├── manifest.json           # 插件描述文件
│   └── mysql-connector.jar     # 驱动文件
├── postgresql/
│   ├── manifest.json
│   └── postgresql.jar
├── redis/
│   ├── manifest.json
│   └── redis-client.so
└── ...
```

### 6.2 manifest.json 示例

```json
{
  "name": "mysql-connector",
  "version": "8.0.33",
  "type": "database",
  "platform": ["windows", "macos", "linux"],
  "files": [
    {
      "name": "mysql-connector-j-8.0.33.jar",
      "url": "https://resources.zwd-opsbot.com/drivers/mysql/mysql-connector-j-8.0.33.jar",
      "sha256": "abc123...",
      "size": 2458624
    }
  ],
  "dependencies": [],
  "minAppVersion": "1.0.0"
}
```

### 6.3 下载流程

```
┌─────────────────────────────────────────────────────────────────┐
│ 驱动下载                                                    [×] │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  首次连接 MySQL 需要下载驱动                                    │
│                                                                 │
│  驱动名称: MySQL Connector/J                                   │
│  版本: 8.0.33                                                   │
│  大小: 2.3 MB                                                   │
│                                                                 │
│  ████████████████░░░░░░░░░░ 65%  1.5MB / 2.3MB                 │
│                                                                 │
│  下载源: ZWD-OpsBot资源站                                       │
│                                                                 │
│  ─────────────────────────────────────────────────────────────  │
│  如果自动下载失败，请手动下载后放置到以下目录：                  │
│  ~/.zwd-opsbot/drivers/mysql/                                  │
│                                                                 │
│  [打开下载页面]  [打开目录]                      [取消]         │
└─────────────────────────────────────────────────────────────────┘
```

---

## 7. 附录

### 7.1 快捷键设计

| 功能 | macOS | Windows/Linux |
|------|-------|---------------|
| 新建连接 | ⌘N | Ctrl+N |
| 新建终端标签 | ⌘T | Ctrl+T |
| 关闭标签 | ⌘W | Ctrl+W |
| 切换标签 | ⌘1-9 | Ctrl+1-9 |
| 复制 | ⌘C | Ctrl+C |
| 粘贴 | ⌘V | Ctrl+V |
| 搜索 | ⌘F | Ctrl+F |
| 设置 | ⌘, | Ctrl+, |
| 水平分屏 | ⌘D | Ctrl+D |
| 垂直分屏 | ⌘⇧D | Ctrl+Shift+D |
| 切换分屏 | ⌘[ / ⌘] | Ctrl+[ / Ctrl+] |
| 执行SQL | F5 | F5 |
| 格式化SQL | ⌘⇧F | Ctrl+Shift+F |

### 7.2 Rust Crate 依赖

```toml
[dependencies]
tauri = { version = "2", features = ["shell-open"] }
russh = "0.40"                    # SSH客户端
russh-keys = "0.40"               # SSH密钥处理
sqlx = { version = "0.7", features = ["runtime-tokio", "mysql", "postgres", "sqlite"] }
bollard = "0.15"                  # Docker API
redis = { version = "0.24", features = ["cluster-async"] }
rdkafka = "0.36"                  # Kafka客户端
elasticsearch = "8.5"             # Elasticsearch客户端
tokio = { version = "1", features = ["full"] }
serde = { version = "1", features = ["derive"] }
serde_json = "1"
anyhow = "1"
thiserror = "1"
ring = "0.17"                     # 加密
base64 = "0.21"
tracing = "0.1"                   # 日志
tracing-subscriber = "0.3"
```

### 7.3 React 依赖

```json
{
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "@tauri-apps/api": "^2",
    "zustand": "^4.5.0",
    "xterm": "^5.3.0",
    "xterm-addon-fit": "^0.8.0",
    "xterm-addon-web-links": "^0.9.0",
    "@monaco-editor/react": "^4.6.0",
    "ag-grid-react": "^31.0.0",
    "@radix-ui/react-dialog": "^1.0.5",
    "@radix-ui/react-dropdown-menu": "^2.0.6",
    "@radix-ui/react-tabs": "^1.0.4",
    "@radix-ui/react-tooltip": "^1.0.7",
    "react-resizable-panels": "^2.0.0",
    "react-i18next": "^14.0.0",
    "i18next": "^23.0.0",
    "lucide-react": "^0.312.0"
  },
  "devDependencies": {
    "typescript": "^5.3.0",
    "tailwindcss": "^3.4.0",
    "vite": "^5.0.0",
    "@vitejs/plugin-react": "^4.2.0"
  }
}
```

---

## 8. 更新记录

| 版本 | 日期 | 更新内容 |
|------|------|----------|
| 1.0 | 2025-12-13 | 初始版本 |
| 1.1 | 2025-12-14 | SFTP文件面板和SSH终端右键菜单功能完善 |
| 1.2 | 2025-12-14 | 数据库管理模块Sprint 4设计更新 |
| 1.3 | 2025-12-14 | 新增表结构管理功能设计（新建表、编辑表结构、修改表名） |
| 1.4 | 2025-12-14 | 完成新建表和编辑表结构功能，移除表结构查看功能 |
| 1.5 | 2025-12-14 | 新增专业数据编辑器（DataEditor）和表分类右键菜单 |

### v1.1 更新详情 (2025-12-14)

#### SFTP 文件面板改进
- **统一右键菜单**：将空白处和文件/文件夹的右键菜单合并为统一菜单
  - 空白处右键：显示刷新、上传、新建文件夹
  - 文件/文件夹右键：显示刷新、上传、新建文件夹 + 编辑/下载/打开/重命名/删除
- **禁用浏览器默认菜单**：全局禁用 Tauri/浏览器默认右键菜单（reload、inspect element）

#### SSH 终端右键菜单（新增）
- **清屏**：清除终端显示内容
- **断开连接**：断开当前 SSH 会话
- **重新连接**：尝试重新建立 SSH 连接
- **保存日志**：将当前终端缓冲区内容保存为 .log 文件
- **开始记录日志**：选择保存路径后实时记录终端输出（500ms 缓冲写入）
- **停止记录日志**：停止记录并保存日志文件

#### 技术改进
- 添加 `@tauri-apps/plugin-fs` 依赖用于文件写入操作
- 使用 `useRef` 解决 Radix UI ContextMenu 状态同步问题
- 添加 `data-file-item` 属性标记文件项，优化右键菜单判断逻辑
- 新增 `append_to_file` 后端命令用于实时追加写入日志文件
- 日志记录采用缓冲机制（500ms 批量写入）避免频繁 I/O 操作

#### 国际化
- 新增 `terminal.*` 翻译键（zh-CN、en-US、zh-TW、ja-JP）
- 新增 `sftp.open` 翻译键
- 补全 zh-TW、ja-JP 的 sftp 模块翻译

### v1.2 更新详情 (2025-12-14)

#### 数据库管理模块设计更新

**数据库对象树（新增）**
- 数据库下支持以下对象类型，显示对象数量：
  - 📋 表 (Tables) - 显示所有表
  - 👁 视图 (Views) - 显示视图列表
  - 📊 物化视图 (Materialized Views) - PostgreSQL专有
  - ƒx 函数 (Functions) - 存储过程和函数
  - 📝 查询 (Saved Queries) - 用户保存的SQL

**SQL编辑器工具栏（新增）**
- [数据库选择 ▼] - 下拉选择当前Schema
- ▶ 运行全部 (⌘+Enter) - 执行所有SQL
- 执行计划 - EXPLAIN分析
- 格式化 - SQL美化
- 压缩 - 压缩为单行
- 导出 ▼ - 导出CSV/Excel/JSON/SQL INSERT
- 💾 保存 (⌘+S) - 保存SQL到查询列表

**表右键菜单（新增）**
- 查看数据 / 编辑数据
- 查看DDL / 查看表结构
- 新建查询 / 复制表名
- 删除表

#### Sprint 4 任务更新
- 新增 S4-016 ~ S4-024 任务覆盖新功能
- 标记已完成任务：S4-001, S4-005~S4-007, S4-009~S4-012, S4-015

### v1.3 更新详情 (2025-12-14)

#### 表结构管理功能设计（新增）

**表右键菜单更新**
- 将"查看数据"改为"新建查询"，功能保持不变（SELECT * FROM table）
- 新增"新建表"菜单项 - 打开建表对话框
- 新增"编辑表结构"菜单项 - 修改列、索引、约束等
- 新增"修改表名"菜单项 - 重命名表

**新建表对话框**
- 支持设置表名、注释
- 列定义：列名、类型、长度、非空、主键、自增、默认值
- 索引定义：索引名、类型（主键/唯一/普通）、列
- SQL预览：实时显示生成的 CREATE TABLE 语句

**编辑表结构对话框**
- 标签页：列、索引、外键、选项
- 列操作：编辑、上移、下移、删除
- 变更预览：显示将要执行的 ALTER TABLE 语句

**修改表名对话框**
- 输入新表名
- SQL预览：RENAME TABLE 语句
- 警告提示：重命名可能影响依赖此表的对象

#### Sprint 4 任务更新
- 新增 S4-025 ~ S4-030 任务覆盖表结构管理功能
- 标记已完成任务：S4-023, S4-024

### v1.4 更新详情 (2025-12-14)

#### 功能完成

**新建表对话框（S4-025）**
- 采用行内编辑模式，直接在表格行中修改所有字段
- Tab 页切换：列、索引、外键、约束、触发器、高级选项
- 列定义：列名、类型、长度、NN(非空)、PK(主键)、AI(自增)、默认值、注释
- 索引定义：索引名、类型（普通/唯一）、方法（BTREE/HASH）、列选择（标签式多选）
- 外键定义：外键名、本表列、引用表、引用列、ON DELETE、ON UPDATE
- 约束定义：约束名、CHECK 表达式
- 触发器定义：卡片式布局，名称、时机、事件、语句
- 高级选项：引擎、字符集
- SQL 预览：可折叠显示生成的 CREATE TABLE 语句

**编辑表结构对话框（S4-027）**
- 采用行内编辑模式，与新建表交互一致
- 行状态标识：绿色=新增、黄色=修改、删除线=删除
- 已有列类型不可修改（避免数据丢失）
- 已有索引/外键/约束/触发器只能删除，不能修改
- SQL 预览：显示将要执行的 ALTER TABLE 语句

#### 功能移除

**移除"查看表结构"菜单（ViewTableStructureDialog）**
- 删除 ViewTableStructureDialog.tsx 组件
- 从右键菜单中移除"查看表结构"选项
- 清理 i18n 翻译文件中的相关条目
- 原因：编辑表结构对话框已包含查看功能，无需单独的只读视图

#### 代码优化
- CreateTableDialog.tsx: 从 863 行精简到 835 行
- EditTableStructureDialog.tsx: 从 1143 行精简到 750 行
- 移除右侧详情面板，改为行内直接编辑

### v1.5 更新详情 (2025-12-14)

#### 数据编辑器（DataEditor）

新增专业的表数据编辑器组件，替代原有的简单 SQL 查询方式：

**工具栏功能**
- 开始事务：支持事务模式编辑
- 刷新：重新加载数据
- 添加行：在末尾添加新行
- 删除行：标记选中行为删除
- 保存：提交所有更改（INSERT/UPDATE/DELETE）
- 撤销：恢复到原始数据
- 筛选：添加列筛选条件
- 排序：点击列头排序
- DDL：查看表结构

**数据表格**
- 行号列：显示当前行号
- 行内编辑：点击单元格直接编辑
- 键盘导航：Tab 切换单元格、Enter 确认、Escape 取消
- 行状态指示：
  - 绿色背景：新增行
  - 黄色背景：已修改行
  - 删除线：待删除行
- NULL 值：斜体灰色显示"NULL"

**分页功能**
- 首页/上一页/下一页/末页按钮
- 当前页码/总页数显示
- 每页行数选择：100/200/500/1000
- 总行数显示（通过 COUNT(*) 查询）

**状态栏**
- SQL 预览：显示当前查询语句
- 选择统计：已选行数、当前行号
- 自动刷新：可选开启（5秒间隔）

#### 表分类右键菜单

在"表"分类节点（如"📋 表 [15]"）上新增右键菜单：
- 新建查询：打开空白 SQL 编辑器
- 新建表：打开建表对话框

#### 国际化更新

新增翻译键（zh-CN、en-US、zh-TW、ja-JP）：
- `common.undo`：撤销
- `database.startTransaction`：开始事务
- `database.filter`：筛选
- `database.sort`：排序
- `database.addFilter`：添加筛选
- `database.selected`：已选
- `database.rows`：行
- `database.current`：当前
- `database.autoRefresh`：自动刷新
- `database.pageSize`：每页行数
- `database.totalRows`：总行数
- `database.firstPage`：首页
- `database.prevPage`：上一页
- `database.nextPage`：下一页
- `database.lastPage`：末页

#### 技术实现

**新增文件**
- `front/components/database/DataEditor.tsx`：数据编辑器组件（~600行）

**修改文件**
- `DatabaseContainer.tsx`：集成 DataEditor，添加 onNewQuery 处理
- `SchemaTree.tsx`：添加表分类右键菜单，新增 onNewQuery 属性
- 4个 i18n 文件：添加新翻译键

---

> 本文档为 ZWD-OpsBot 第一阶段开发计划，后续会根据实际开发情况进行调整。
